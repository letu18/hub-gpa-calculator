<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUB GPA Calculator - T√≠nh ƒêi·ªÉm GPA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 25%, #2c5364 50%, #1a365d 75%, #0d1b2a 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #e2e8f0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: #ffffff;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            background: linear-gradient(45deg, #4fd1c7, #63b3ed, #90cdf4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            color: #cbd5e0;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, rgba(26, 54, 93, 0.9) 0%, rgba(45, 83, 100, 0.9) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(79, 209, 199, 0.2);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3), 0 5px 15px rgba(79, 209, 199, 0.1);
            color: #e2e8f0;
        }

        .card h3 {
            color: #4fd1c7;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            font-size: 1.5em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .card h3 i {
            margin-right: 10px;
            color: #63b3ed;
        }

        /* Semester Tabs */
        .semester-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab {
            padding: 12px 20px;
            background: rgba(26, 54, 93, 0.8);
            border: 1px solid rgba(79, 209, 199, 0.3);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #cbd5e0;
        }

        .tab.active {
            background: linear-gradient(45deg, #4fd1c7, #63b3ed);
            color: #0d1b2a;
            box-shadow: 0 5px 15px rgba(79, 209, 199, 0.4);
            transform: translateY(-2px);
            border-color: transparent;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 209, 199, 0.3);
            border-color: #4fd1c7;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4fd1c7;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(79, 209, 199, 0.3);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(13, 27, 42, 0.8);
            color: #e2e8f0;
        }

        .form-group input::placeholder {
            color: #a0aec0;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4fd1c7;
            box-shadow: 0 0 0 3px rgba(79, 209, 199, 0.2);
            background: rgba(13, 27, 42, 0.9);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            margin: 5px;
            color: white;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4fd1c7, #63b3ed);
            color: #0d1b2a;
        }

        .btn-success {
            background: linear-gradient(45deg, #48bb78, #38b2ac);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #f56565, #e53e3e);
            color: white;
        }

        .btn-language {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: 2px solid rgba(79, 209, 199, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 10px 25px rgba(79, 209, 199, 0.4);
        }

        .btn-language:hover {
            border-color: #4fd1c7;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        /* Average Display */
        .average-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #4fd1c7, #63b3ed);
            color: #0d1b2a;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(79, 209, 199, 0.3);
        }

        /* Subject List */
        .subjects-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .subject-item {
            display: grid;
            grid-template-columns: 2fr 3fr 1fr 1fr 1fr 1fr;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: rgba(13, 27, 42, 0.6);
            border: 1px solid rgba(79, 209, 199, 0.2);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .subject-item:hover {
            background: rgba(13, 27, 42, 0.8);
            transform: translateX(5px);
            border-color: #4fd1c7;
        }

        .subject-scores {
            display: flex;
            gap: 10px;
        }

        .score-item {
            background: rgba(79, 209, 199, 0.2);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            color: #4fd1c7;
            border: 1px solid rgba(79, 209, 199, 0.3);
        }

        /* Grade Levels */
        .grade-level {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }

        .grade-excellent { background: #4fd1c7; color: #0d1b2a; }
        .grade-good { background: #63b3ed; color: #0d1b2a; }
        .grade-fair { background: #90cdf4; color: #0d1b2a; }
        .grade-average { background: #48bb78; color: white; }
        .grade-poor { background: #a0aec0; color: #0d1b2a; }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(26, 54, 93, 0.9) 0%, rgba(45, 83, 100, 0.9) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(79, 209, 199, 0.2);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #4fd1c7;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .stat-label {
            color: #cbd5e0;
            font-weight: 500;
        }

        /* GPA Progress */
        .gpa-progress {
            background: rgba(13, 27, 42, 0.8);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            border: 1px solid rgba(79, 209, 199, 0.3);
        }

        .gpa-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #4fd1c7, #63b3ed);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        /* Year Overview */
        .year-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .year-item {
            background: rgba(13, 27, 42, 0.6);
            border: 1px solid rgba(79, 209, 199, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .year-item:hover {
            border-color: #4fd1c7;
            background: rgba(13, 27, 42, 0.8);
        }

        .year-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #4fd1c7;
        }

        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
            border: 1px solid;
        }

        .alert-success {
            background: rgba(72, 187, 120, 0.2);
            color: #48bb78;
            border-color: #48bb78;
        }

        .alert-warning {
            background: rgba(237, 137, 54, 0.2);
            color: #ed8936;
            border-color: #ed8936;
        }

        /* AI Suggestions */
        .suggestions-content {
            max-height: 300px;
            overflow-y: auto;
        }

        .suggestion-item {
            background: rgba(13, 27, 42, 0.6);
            border: 1px solid rgba(79, 209, 199, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #4fd1c7;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(26, 54, 93, 0.95) 0%, rgba(45, 83, 100, 0.95) 100%);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(79, 209, 199, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            margin: 50px auto;
            position: relative;
            color: #e2e8f0;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #a0aec0;
        }

        .close:hover {
            color: #4fd1c7;
        }

        /* Chat Messages */
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(79, 209, 199, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            background: rgba(13, 27, 42, 0.6);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input-container input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid rgba(79, 209, 199, 0.3);
            border-radius: 25px;
            font-size: 16px;
            background: rgba(13, 27, 42, 0.8);
            color: #e2e8f0;
        }

        /* Charts Modal */
        .charts-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            overflow-y: auto;
        }

        .charts-modal-content {
            background: linear-gradient(135deg, rgba(26, 54, 93, 0.95) 0%, rgba(45, 83, 100, 0.95) 100%);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(79, 209, 199, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 1200px;
            margin: 20px auto;
            position: relative;
            min-height: 80vh;
            color: #e2e8f0;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .chart-container {
            background: rgba(13, 27, 42, 0.6);
            border: 1px solid rgba(79, 209, 199, 0.2);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            height: 400px;
        }

        .chart-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-item {
            background: linear-gradient(135deg, #4fd1c7, #63b3ed);
            color: #0d1b2a;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(79, 209, 199, 0.3);
        }

        .chart-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: rgba(13, 27, 42, 0.6);
            border: 1px solid rgba(79, 209, 199, 0.2);
            border-radius: 10px;
            padding: 5px;
        }

        .chart-tab {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            margin: 0 5px;
            color: #cbd5e0;
        }

        .chart-tab.active {
            background: linear-gradient(45deg, #4fd1c7, #63b3ed);
            color: #0d1b2a;
            box-shadow: 0 5px 15px rgba(79, 209, 199, 0.3);
        }

        .chart-section {
            display: none;
        }

        .chart-section.active {
            display: block;
        }

        /* Language Button Specific Styles */
        .language-section {
            text-align: center;
            margin: 20px 0;
        }

        .btn-language {
            font-size: 18px;
            padding: 15px 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: 2px solid rgba(79, 209, 199, 0.4);
            border-radius: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-language::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-language:hover::before {
            left: 100%;
        }

        .btn-language:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
            border-color: #4fd1c7;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .subject-item {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .year-overview {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .semester-tabs {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .card {
            animation: fadeIn 0.5s ease-out;
        }

        /* Tooltips */
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(13, 27, 42, 0.9);
            color: #4fd1c7;
            border: 1px solid rgba(79, 209, 199, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
        }

        kbd {
            background: rgba(79, 209, 199, 0.2);
            border: 1px solid rgba(79, 209, 199, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
            color: #4fd1c7;
        }

        /* Additional International Theme Elements */
        .international-badge {
            display: inline-block;
            background: linear-gradient(45deg, #4fd1c7, #63b3ed);
            color: #0d1b2a;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(13, 27, 42, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #4fd1c7, #63b3ed);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #38b2ac, #4299e1);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-graduation-cap"></i> HUB GPA Calculator</h1>
            <span class="international-badge">International Edition</span>
            <p>H·ªá th·ªëng t√≠nh ƒëi·ªÉm GPA th√¥ng minh - H·ªó tr·ª£ v·ªõi AI Assistant</p>
            
            <!-- Language Section -->
            <div class="language-section">
                <button class="btn btn-language" onclick="openLanguagePage()">
                    <i class="fas fa-globe"></i> Ngo·∫°i ng·ªØ
                </button>
            </div>
            
            <!-- Action Buttons -->
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="exportData()">
                    <i class="fas fa-download"></i> Xu·∫•t d·ªØ li·ªáu
                </button>
                <label class="btn btn-primary" style="cursor: pointer;">
                    <i class="fas fa-upload"></i> Nh·∫≠p d·ªØ li·ªáu
                    <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                </label>
                <button class="btn btn-primary" onclick="showChartsModal()" style="background: linear-gradient(45deg, #48bb78, #38b2ac);">
                    <i class="fas fa-chart-bar"></i> Xem bi·ªÉu ƒë·ªì
                </button>
                <button class="btn btn-danger" onclick="resetAllData()">
                    <i class="fas fa-trash-alt"></i> X√≥a t·∫•t c·∫£
                </button>
                <button class="btn btn-primary" onclick="showHelpModal()" style="background: linear-gradient(45deg, #667eea, #764ba2);">
                    <i class="fas fa-question-circle"></i> H∆∞·ªõng d·∫´n
                </button>
            </div>
        </div>

        <!-- Semester Tabs -->
        <div class="semester-tabs">
            <button class="tab active" data-semester="1">HK 1</button>
            <button class="tab" data-semester="2">HK 2</button>
            <button class="tab" data-semester="3">HK 3</button>
            <button class="tab" data-semester="4">HK 4</button>
            <button class="tab" data-semester="5">HK 5</button>
            <button class="tab" data-semester="6">HK 6</button>
            <button class="tab" data-semester="7">HK 7</button>
            <button class="tab" data-semester="8">HK 8</button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Input Form -->
            <div class="card">
                <h3><i class="fas fa-plus-circle"></i> Th√™m m√¥n h·ªçc - <span id="currentSemesterTitle">H·ªçc k·ª≥ 1</span></h3>
                
                <div class="form-group">
                    <label for="subjectName">T√™n m√¥n h·ªçc:</label>
                    <input type="text" id="subjectName" placeholder="Nh·∫≠p t√™n m√¥n h·ªçc">
                </div>

                <div class="form-group">
                    <label for="credits">S·ªë t√≠n ch·ªâ:</label>
                    <input type="number" id="credits" min="1" max="10" placeholder="S·ªë t√≠n ch·ªâ">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="attendance">Chuy√™n c·∫ßn (10%):</label>
                        <input type="number" id="attendance" min="0" max="10" step="0.1" placeholder="0-10" 
                               data-tooltip="ƒêi·ªÉm chuy√™n c·∫ßn (0-10), chi·∫øm 10% t·ªïng ƒëi·ªÉm">
                    </div>
                    <div class="form-group">
                        <label for="homework">B√†i t·∫≠p (20%):</label>
                        <input type="number" id="homework" min="0" max="10" step="0.1" placeholder="0-10"
                               data-tooltip="ƒêi·ªÉm b√†i t·∫≠p (0-10), chi·∫øm 20% t·ªïng ƒëi·ªÉm">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="midterm">Gi·ªØa k·ª≥ (20%):</label>
                        <input type="number" id="midterm" min="0" max="10" step="0.1" placeholder="0-10"
                               data-tooltip="ƒêi·ªÉm gi·ªØa k·ª≥ (0-10), chi·∫øm 20% t·ªïng ƒëi·ªÉm">
                    </div>
                    <div class="form-group">
                        <label for="final">Cu·ªëi k·ª≥ (50%):</label>
                        <input type="number" id="final" min="0" max="10" step="0.1" placeholder="0-10"
                               data-tooltip="ƒêi·ªÉm cu·ªëi k·ª≥ (0-10), chi·∫øm 50% t·ªïng ƒëi·ªÉm">
                    </div>
                </div>

                <div class="average-display" id="averageDisplay">
                    ƒêi·ªÉm TB: --
                </div>

                <button class="btn btn-primary" onclick="addSubject()" style="width: 100%;">
                    <i class="fas fa-plus"></i> Th√™m m√¥n h·ªçc
                </button>
            </div>

            <!-- Subject List -->
            <div class="card">
                <h3><i class="fas fa-list"></i> Danh s√°ch m√¥n h·ªçc</h3>
                <div class="subjects-list" id="subjectsList">
                    <p style="text-align: center; color: #a0aec0; padding: 20px;">
                        Ch∆∞a c√≥ m√¥n h·ªçc n√†o. H√£y th√™m m√¥n h·ªçc ƒë·∫ßu ti√™n!
                    </p>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="currentGPA">0.00</div>
                                <div class="stat-label">GPA Hi·ªán t·∫°i</div>
                <div class="gpa-progress">
                    <div class="gpa-progress-bar" id="gpaProgressBar" style="width: 0%"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCredits">0</div>
                <div class="stat-label">T·ªïng t√≠n ch·ªâ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalSubjects">0</div>
                <div class="stat-label">T·ªïng m√¥n h·ªçc</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="averageGrade">--</div>
                <div class="stat-label">X·∫øp lo·∫°i</div>
            </div>
        </div>

        <!-- Year Overview -->
        <div class="card">
            <h3><i class="fas fa-calendar-alt"></i> T·ªïng quan theo nƒÉm h·ªçc</h3>
            <div class="year-overview">
                <div class="year-item">
                    <div class="year-number" id="year1GPA">0.00</div>
                    <div>NƒÉm 1</div>
                    <small>HK 1-2</small>
                </div>
                <div class="year-item">
                    <div class="year-number" id="year2GPA">0.00</div>
                    <div>NƒÉm 2</div>
                    <small>HK 3-4</small>
                </div>
                <div class="year-item">
                    <div class="year-number" id="year3GPA">0.00</div>
                    <div>NƒÉm 3</div>
                    <small>HK 5-6</small>
                </div>
                <div class="year-item">
                    <div class="year-number" id="year4GPA">0.00</div>
                    <div>NƒÉm 4</div>
                    <small>HK 7-8</small>
                </div>
            </div>
        </div>

        <!-- AI Suggestions -->
        <div class="card">
            <h3><i class="fas fa-robot"></i> AI Assistant - G·ª£i √Ω h·ªçc t·∫≠p</h3>
            <div class="suggestions-content" id="suggestionsContent">
                <div class="suggestion-item">
                    <strong>üí° G·ª£i √Ω:</strong> H√£y th√™m ƒëi·ªÉm s·ªë ƒë·ªÉ AI c√≥ th·ªÉ ƒë∆∞a ra nh·ªØng l·ªùi khuy√™n ph√π h·ª£p cho b·∫°n!
                </div>
            </div>
            <button class="btn btn-primary" onclick="openChatModal()" style="width: 100%; margin-top: 15px;">
                <i class="fas fa-comments"></i> Chat v·ªõi AI Assistant
            </button>
        </div>

        <!-- Alerts -->
        <div class="alert alert-success" id="successAlert">
            <i class="fas fa-check-circle"></i> <span id="successMessage"></span>
        </div>
        <div class="alert alert-warning" id="warningAlert">
            <i class="fas fa-exclamation-triangle"></i> <span id="warningMessage"></span>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div id="chatModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeChatModal()">&times;</span>
            <h2><i class="fas fa-robot"></i> AI Assistant</h2>
            <div class="chat-messages" id="chatMessages">
                <div style="color: #4fd1c7; margin-bottom: 10px;">
                    <strong>AI Assistant:</strong> Xin ch√†o! T√¥i l√† tr·ª£ l√Ω AI c·ªßa b·∫°n. H√£y h·ªèi t√¥i v·ªÅ vi·ªác h·ªçc t·∫≠p, c√°ch c·∫£i thi·ªán ƒëi·ªÉm s·ªë, ho·∫∑c b·∫•t k·ª≥ ƒëi·ªÅu g√¨ li√™n quan ƒë·∫øn GPA c·ªßa b·∫°n!
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." onkeypress="handleChatEnter(event)">
                <button class="btn btn-primary" onclick="sendChatMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Charts Modal -->
    <div id="chartsModal" class="charts-modal">
        <div class="charts-modal-content">
            <span class="close" onclick="closeChartsModal()" style="color: #a0aec0; font-size: 28px;">&times;</span>
            <h2><i class="fas fa-chart-bar"></i> Bi·ªÉu ƒë·ªì ph√¢n t√≠ch GPA</h2>
            
            <div class="chart-tabs">
                <div class="chart-tab active" onclick="showChartSection('overview')">T·ªïng quan</div>
                <div class="chart-tab" onclick="showChartSection('semester')">Theo h·ªçc k·ª≥</div>
                <div class="chart-tab" onclick="showChartSection('subject')">Theo m√¥n h·ªçc</div>
                <div class="chart-tab" onclick="showChartSection('prediction')">D·ª± ƒëo√°n</div>
            </div>

            <!-- Overview Charts -->
            <div id="overviewCharts" class="chart-section active">
                <div class="chart-stats">
                    <div class="stat-item">
                        <div style="font-size: 2em; margin-bottom: 5px;" id="chartCurrentGPA">0.00</div>
                        <div>GPA Hi·ªán t·∫°i</div>
                    </div>
                    <div class="stat-item">
                        <div style="font-size: 2em; margin-bottom: 5px;" id="chartTotalCredits">0</div>
                        <div>T·ªïng t√≠n ch·ªâ</div>
                    </div>
                    <div class="stat-item">
                        <div style="font-size: 2em; margin-bottom: 5px;" id="chartHighestGPA">0.00</div>
                        <div>GPA cao nh·∫•t</div>
                    </div>
                    <div class="stat-item">
                        <div style="font-size: 2em; margin-bottom: 5px;" id="chartLowestGPA">0.00</div>
                        <div>GPA th·∫•p nh·∫•t</div>
                    </div>
                </div>
                <div class="charts-grid">
                    <div class="chart-container">
                        <h4 style="text-align: center; margin-bottom: 20px; color: #4fd1c7;">Ph√¢n b·ªë ƒëi·ªÉm theo thang 4</h4>
                        <canvas id="gradeDistributionChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4 style="text-align: center; margin-bottom: 20px; color: #4fd1c7;">Ti·∫øn ƒë·ªô GPA theo th·ªùi gian</h4>
                        <canvas id="gpaProgressChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Semester Charts -->
            <div id="semesterCharts" class="chart-section">
                <div class="charts-grid">
                    <div class="chart-container">
                        <h4 style="text-align: center; margin-bottom: 20px; color: #4fd1c7;">GPA theo h·ªçc k·ª≥</h4>
                        <canvas id="semesterGPAChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4 style="text-align: center; margin-bottom: 20px; color: #4fd1c7;">S·ªë t√≠n ch·ªâ theo h·ªçc k·ª≥</h4>
                        <canvas id="semesterCreditsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Subject Charts -->
            <div id="subjectCharts" class="chart-section">
                <div class="charts-grid">
                    <div class="chart-container">
                        <h4 style="text-align: center; margin-bottom: 20px; color: #4fd1c7;">Top m√¥n h·ªçc ƒëi·ªÉm cao</h4>
                        <canvas id="topSubjectsChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4 style="text-align: center; margin-bottom: 20px; color: #4fd1c7;">Ph√¢n t√≠ch th√†nh ph·∫ßn ƒëi·ªÉm</h4>
                        <canvas id="scoreComponentsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Prediction Charts -->
            <div id="predictionCharts" class="chart-section">
                <div class="chart-container" style="grid-column: 1 / -1;">
                    <h4 style="text-align: center; margin-bottom: 20px; color: #4fd1c7;">D·ª± ƒëo√°n GPA t∆∞∆°ng lai</h4>
                    <div style="text-align: center; margin-bottom: 20px;">
                        <label style="color: #4fd1c7; margin-right: 10px;">GPA m·ª•c ti√™u:</label>
                        <input type="number" id="targetGPA" min="0" max="4" step="0.1" value="3.5" 
                               style="padding: 8px; border-radius: 5px; border: 1px solid #4fd1c7; background: rgba(13, 27, 42, 0.8); color: #e2e8f0;">
                        <button class="btn btn-primary" onclick="calculatePrediction()" style="margin-left: 10px;">
                            <i class="fas fa-calculator"></i> T√≠nh to√°n
                        </button>
                    </div>
                    <div id="predictionResults" style="background: rgba(13, 27, 42, 0.6); padding: 20px; border-radius: 10px; border: 1px solid rgba(79, 209, 199, 0.2);">
                        <p style="text-align: center; color: #a0aec0;">Nh·∫≠p GPA m·ª•c ti√™u v√† nh·∫•n "T√≠nh to√°n" ƒë·ªÉ xem d·ª± ƒëo√°n</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeHelpModal()">&times;</span>
            <h2><i class="fas fa-question-circle"></i> H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h2>
            
            <div style="max-height: 400px; overflow-y: auto;">
                <h3 style="color: #4fd1c7; margin-top: 20px;">üéØ C√°ch s·ª≠ d·ª•ng c∆° b·∫£n:</h3>
                <ul style="line-height: 1.8; color: #cbd5e0;">
                    <li><strong>Ch·ªçn h·ªçc k·ª≥:</strong> Click v√†o c√°c tab HK 1-8 ƒë·ªÉ chuy·ªÉn ƒë·ªïi gi·ªØa c√°c h·ªçc k·ª≥</li>
                    <li><strong>Th√™m m√¥n h·ªçc:</strong> Nh·∫≠p t√™n m√¥n, s·ªë t√≠n ch·ªâ v√† c√°c ƒëi·ªÉm th√†nh ph·∫ßn</li>
                    <li><strong>Xem th·ªëng k√™:</strong> GPA, t·ªïng t√≠n ch·ªâ v√† x·∫øp lo·∫°i ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª± ƒë·ªông</li>
                    <li><strong>Xu·∫•t/Nh·∫≠p d·ªØ li·ªáu:</strong> Sao l∆∞u v√† kh√¥i ph·ª•c d·ªØ li·ªáu b·∫±ng file JSON</li>
                </ul>

                <h3 style="color: #4fd1c7; margin-top: 20px;">üìä Thang ƒëi·ªÉm:</h3>
                <ul style="line-height: 1.8; color: #cbd5e0;">
                    <li><strong>Xu·∫•t s·∫Øc (A):</strong> 8.5 - 10.0 (GPA: 3.7 - 4.0)</li>
                    <li><strong>Gi·ªèi (B):</strong> 7.0 - 8.4 (GPA: 3.0 - 3.6)</li>
                    <li><strong>Kh√° (C):</strong> 5.5 - 6.9 (GPA: 2.0 - 2.9)</li>
                    <li><strong>Trung b√¨nh (D):</strong> 4.0 - 5.4 (GPA: 1.0 - 1.9)</li>
                    <li><strong>Y·∫øu (F):</strong> < 4.0 (GPA: < 1.0)</li>
                </ul>

                <h3 style="color: #4fd1c7; margin-top: 20px;">üîß T√≠nh nƒÉng n√¢ng cao:</h3>
                <ul style="line-height: 1.8; color: #cbd5e0;">
                    <li><strong>AI Assistant:</strong> Chat v·ªõi AI ƒë·ªÉ nh·∫≠n t∆∞ v·∫•n h·ªçc t·∫≠p</li>
                    <li><strong>Bi·ªÉu ƒë·ªì:</strong> Xem ph√¢n t√≠ch tr·ª±c quan v·ªÅ ti·∫øn ƒë·ªô h·ªçc t·∫≠p</li>
                    <li><strong>D·ª± ƒëo√°n:</strong> T√≠nh to√°n ƒëi·ªÉm c·∫ßn thi·∫øt ƒë·ªÉ ƒë·∫°t GPA m·ª•c ti√™u</li>
                    <li><strong>Ph√≠m t·∫Øt:</strong> <kbd>Enter</kbd> ƒë·ªÉ th√™m m√¥n, <kbd>Esc</kbd> ƒë·ªÉ ƒë√≥ng modal</li>
                </ul>

                <h3 style="color: #4fd1c7; margin-top: 20px;">üåü M·∫πo s·ª≠ d·ª•ng:</h3>
                <ul style="line-height: 1.8; color: #cbd5e0;">
                    <li>C·∫≠p nh·∫≠t ƒëi·ªÉm th∆∞·ªùng xuy√™n ƒë·ªÉ theo d√µi ti·∫øn ƒë·ªô</li>
                    <li>S·ª≠ d·ª•ng t√≠nh nƒÉng d·ª± ƒëo√°n ƒë·ªÉ l·∫≠p k·∫ø ho·∫°ch h·ªçc t·∫≠p</li>
                    <li>Chat v·ªõi AI ƒë·ªÉ nh·∫≠n l·ªùi khuy√™n c·∫£i thi·ªán ƒëi·ªÉm s·ªë</li>
                    <li>Xu·∫•t d·ªØ li·ªáu ƒë·ªãnh k·ª≥ ƒë·ªÉ sao l∆∞u</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Global variables
        let currentSemester = 1;
        let semesterData = {};
        let charts = {};

        // Initialize data structure for all semesters
        for (let i = 1; i <= 8; i++) {
            semesterData[i] = [];
        }

        // Load data from localStorage on page load
        window.addEventListener('load', function() {
            loadData();
            updateDisplay();
            generateAISuggestions();
        });

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                currentSemester = parseInt(this.dataset.semester);
                document.getElementById('currentSemesterTitle').textContent = `H·ªçc k·ª≥ ${currentSemester}`;
                updateDisplay();
                clearForm();
            });
        });

        // Real-time average calculation
        ['attendance', 'homework', 'midterm', 'final'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateAverage);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                const activeElement = document.activeElement;
                if (activeElement.tagName === 'INPUT' && activeElement.closest('.card')) {
                    e.preventDefault();
                    addSubject();
                }
            }
            if (e.key === 'Escape') {
                closeAllModals();
            }
        });

        function calculateAverage() {
            const attendance = parseFloat(document.getElementById('attendance').value) || 0;
            const homework = parseFloat(document.getElementById('homework').value) || 0;
            const midterm = parseFloat(document.getElementById('midterm').value) || 0;
            const final = parseFloat(document.getElementById('final').value) || 0;

            const average = (attendance * 0.1 + homework * 0.2 + midterm * 0.2 + final * 0.5);
            
            document.getElementById('averageDisplay').textContent = `ƒêi·ªÉm TB: ${average.toFixed(2)}`;
            document.getElementById('averageDisplay').style.background = 
                average >= 8.5 ? 'linear-gradient(45deg, #48bb78, #38b2ac)' :
                average >= 7.0 ? 'linear-gradient(45deg, #4fd1c7, #63b3ed)' :
                average >= 5.5 ? 'linear-gradient(45deg, #ed8936, #f6ad55)' :
                average >= 4.0 ? 'linear-gradient(45deg, #f56565, #fc8181)' :
                'linear-gradient(45deg, #a0aec0, #cbd5e0)';
        }

        function addSubject() {
            const name = document.getElementById('subjectName').value.trim();
            const credits = parseInt(document.getElementById('credits').value);
            const attendance = parseFloat(document.getElementById('attendance').value);
            const homework = parseFloat(document.getElementById('homework').value);
            const midterm = parseFloat(document.getElementById('midterm').value);
            const final = parseFloat(document.getElementById('final').value);

            // Validation
            if (!name) {
                showAlert('warning', 'Vui l√≤ng nh·∫≠p t√™n m√¥n h·ªçc!');
                return;
            }
            if (!credits || credits < 1 || credits > 10) {
                showAlert('warning', 'S·ªë t√≠n ch·ªâ ph·∫£i t·ª´ 1 ƒë·∫øn 10!');
                return;
            }
            if (isNaN(attendance) || isNaN(homework) || isNaN(midterm) || isNaN(final)) {
                showAlert('warning', 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ƒëi·ªÉm s·ªë!');
                return;
            }
            if ([attendance, homework, midterm, final].some(score => score < 0 || score > 10)) {
                showAlert('warning', 'ƒêi·ªÉm s·ªë ph·∫£i t·ª´ 0 ƒë·∫øn 10!');
                return;
            }

            const average = (attendance * 0.1 + homework * 0.2 + midterm * 0.2 + final * 0.5);
            const gpa4 = convertToGPA4(average);

            const subject = {
                id: Date.now(),
                name,
                credits,
                attendance,
                homework,
                midterm,
                final,
                average,
                gpa4
            };

            semesterData[currentSemester].push(subject);
            saveData();
            updateDisplay();
            clearForm();
            generateAISuggestions();
            showAlert('success', `ƒê√£ th√™m m√¥n "${name}" th√†nh c√¥ng!`);
        }

        function deleteSubject(semesterId, subjectId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a m√¥n h·ªçc n√†y?')) {
                semesterData[semesterId] = semesterData[semesterId].filter(s => s.id !== subjectId);
                saveData();
                updateDisplay();
                generateAISuggestions();
                showAlert('success', 'ƒê√£ x√≥a m√¥n h·ªçc th√†nh c√¥ng!');
            }
        }

        function convertToGPA4(score) {
            if (score >= 8.5) return 4.0;
            if (score >= 8.0) return 3.7;
            if (score >= 7.5) return 3.5;
            if (score >= 7.0) return 3.0;
            if (score >= 6.5) return 2.5;
            if (score >= 6.0) return 2.0;
            if (score >= 5.5) return 1.5;
            if (score >= 5.0) return 1.0;
            if (score >= 4.0) return 0.5;
            return 0.0;
        }

        function getGradeLevel(score) {
            if (score >= 8.5) return { text: 'Xu·∫•t s·∫Øc', class: 'grade-excellent' };
            if (score >= 7.0) return { text: 'Gi·ªèi', class: 'grade-good' };
            if (score >= 5.5) return { text: 'Kh√°', class: 'grade-fair' };
            if (score >= 4.0) return { text: 'Trung b√¨nh', class: 'grade-average' };
            return { text: 'Y·∫øu', class: 'grade-poor' };
        }

        function updateDisplay() {
            updateSubjectsList();
            updateStatistics();
            updateYearOverview();
        }

        function updateSubjectsList() {
            const container = document.getElementById('subjectsList');
            const subjects = semesterData[currentSemester];

            if (subjects.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #a0aec0; padding: 20px;">Ch∆∞a c√≥ m√¥n h·ªçc n√†o. H√£y th√™m m√¥n h·ªçc ƒë·∫ßu ti√™n!</p>';
                return;
            }

            container.innerHTML = subjects.map(subject => {
                const grade = getGradeLevel(subject.average);
                return `
                    <div class="subject-item">
                        <div>
                            <strong style="color: #4fd1c7;">${subject.name}</strong>
                            <div style="font-size: 12px; color: #a0aec0; margin-top: 5px;">
                                ${subject.credits} t√≠n ch·ªâ
                            </div>
                        </div>
                        <div class="subject-scores">
                            <div class="score-item">CC: ${subject.attendance}</div>
                            <div class="score-item">BT: ${subject.homework}</div>
                            <div class="score-item">GK: ${subject.midterm}</div>
                            <div class="score-item">CK: ${subject.final}</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-weight: bold; color: #4fd1c7; font-size: 18px;">
                                ${subject.average.toFixed(2)}
                            </div>
                            <div style="font-size: 12px; color: #a0aec0;">
                                GPA: ${subject.gpa4.toFixed(1)}
                            </div>
                        </div>
                        <div class="grade-level ${grade.class}">
                            ${grade.text}
                        </div>
                        <button class="btn btn-danger" onclick="deleteSubject(${currentSemester}, ${subject.id})" 
                                style="padding: 8px 12px; font-size: 14px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            }).join('');
        }

        function updateStatistics() {
            let totalCredits = 0;
            let totalGradePoints = 0;
            let totalSubjects = 0;

            // Calculate overall statistics
            for (let semester = 1; semester <= 8; semester++) {
                semesterData[semester].forEach(subject => {
                    totalCredits += subject.credits;
                    totalGradePoints += subject.gpa4 * subject.credits;
                    totalSubjects++;
                });
            }

            const currentGPA = totalCredits > 0 ? (totalGradePoints / totalCredits) : 0;
            const gradeLevel = getGradeLevel(currentGPA * 2.5);

            document.getElementById('currentGPA').textContent = currentGPA.toFixed(2);
            document.getElementById('totalCredits').textContent = totalCredits;
            document.getElementById('totalSubjects').textContent = totalSubjects;
            document.getElementById('averageGrade').textContent = gradeLevel.text;

            // Update progress bar
            const progressPercentage = (currentGPA / 4) * 100;
            document.getElementById('gpaProgressBar').style.width = `${progressPercentage}%`;

            // Update chart stats
            document.getElementById('chartCurrentGPA').textContent = currentGPA.toFixed(2);
            document.getElementById('chartTotalCredits').textContent = totalCredits;
        }

        function updateYearOverview() {
            const years = [
                { semesters: [1, 2], element: 'year1GPA' },
                { semesters: [3, 4], element: 'year2GPA' },
                { semesters: [5, 6], element: 'year3GPA' },
                { semesters: [7, 8], element: 'year4GPA' }
            ];

            years.forEach(year => {
                let totalCredits = 0;
                let totalGradePoints = 0;

                year.semesters.forEach(semester => {
                    semesterData[semester].forEach(subject => {
                        totalCredits += subject.credits;
                        totalGradePoints += subject.gpa4 * subject.credits;
                    });
                });

                const yearGPA = totalCredits > 0 ? (totalGradePoints / totalCredits) : 0;
                document.getElementById(year.element).textContent = yearGPA.toFixed(2);
            });
        }

        function clearForm() {
            document.getElementById('subjectName').value = '';
            document.getElementById('credits').value = '';
            document.getElementById('attendance').value = '';
            document.getElementById('homework').value = '';
            document.getElementById('midterm').value = '';
            document.getElementById('final').value = '';
            document.getElementById('averageDisplay').textContent = 'ƒêi·ªÉm TB: --';
            document.getElementById('averageDisplay').style.background = 'linear-gradient(45deg, #4fd1c7, #63b3ed)';
        }

        function saveData() {
            localStorage.setItem('gpaCalculatorData', JSON.stringify(semesterData));
        }

        function loadData() {
            const saved = localStorage.getItem('gpaCalculatorData');
            if (saved) {
                semesterData = JSON.parse(saved);
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(semesterData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `gpa-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showAlert('success', 'ƒê√£ xu·∫•t d·ªØ li·ªáu th√†nh c√¥ng!');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (confirm('D·ªØ li·ªáu hi·ªán t·∫°i s·∫Ω b·ªã ghi ƒë√®. B·∫°n c√≥ ch·∫Øc ch·∫Øn?')) {
                        semesterData = imported;
                        saveData();
                        updateDisplay();
                        generateAISuggestions();
                        showAlert('success', 'ƒê√£ nh·∫≠p d·ªØ li·ªáu th√†nh c√¥ng!');
                    }
                } catch (error) {
                    showAlert('warning', 'File kh√¥ng h·ª£p l·ªá!');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function resetAllData() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
                for (let i = 1; i <= 8; i++) {
                    semesterData[i] = [];
                }
                saveData();
                updateDisplay();
                generateAISuggestions();
                showAlert('success', 'ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu!');
            }
        }

        function showAlert(type, message) {
            const alertElement = document.getElementById(type + 'Alert');
            const messageElement = document.getElementById(type + 'Message');
            messageElement.textContent = message;
            alertElement.style.display = 'block';
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 3000);
        }

        // AI Assistant Functions
        function generateAISuggestions() {
            const container = document.getElementById('suggestionsContent');
            let suggestions = [];

            // Calculate current GPA
            let totalCredits = 0;
            let totalGradePoints = 0;
            for (let semester = 1; semester <= 8; semester++) {
                semesterData[semester].forEach(subject => {
                    totalCredits += subject.credits;
                    totalGradePoints += subject.gpa4 * subject.credits;
                });
            }
            const currentGPA = totalCredits > 0 ? (totalGradePoints / totalCredits) : 0;

            // Generate suggestions based on GPA
            if (currentGPA >= 3.5) {
                suggestions.push({
                    icon: 'üéâ',
                    title: 'Xu·∫•t s·∫Øc!',
                                        content: 'GPA c·ªßa b·∫°n r·∫•t t·ªët! H√£y duy tr√¨ phong ƒë·ªô n√†y v√† t·∫≠p trung v√†o c√°c ho·∫°t ƒë·ªông ngo·∫°i kh√≥a ƒë·ªÉ ho√†n thi·ªán h·ªì s∆°.'
                });
            } else if (currentGPA >= 3.0) {
                suggestions.push({
                    icon: 'üëç',
                    title: 'T·ªët!',
                    content: 'GPA c·ªßa b·∫°n ·ªü m·ª©c kh√° t·ªët. H√£y c·ªë g·∫Øng c·∫£i thi·ªán c√°c m√¥n y·∫øu ƒë·ªÉ ƒë·∫°t m·ª©c xu·∫•t s·∫Øc.'
                });
            } else if (currentGPA >= 2.0) {
                suggestions.push({
                    icon: 'üìà',
                    title: 'C·∫ßn c·∫£i thi·ªán',
                    content: 'GPA c·ªßa b·∫°n c·∫ßn ƒë∆∞·ª£c c·∫£i thi·ªán. H√£y t·∫≠p trung v√†o vi·ªác h·ªçc v√† t√¨m ki·∫øm s·ª± h·ªó tr·ª£ t·ª´ gi·∫£ng vi√™n.'
                });
            } else if (totalCredits > 0) {
                suggestions.push({
                    icon: '‚ö†Ô∏è',
                    title: 'C·∫ßn n·ªó l·ª±c nhi·ªÅu h∆°n',
                    content: 'GPA hi·ªán t·∫°i kh√° th·∫•p. H√£y xem x√©t l·∫°i ph∆∞∆°ng ph√°p h·ªçc t·∫≠p v√† t√¨m ki·∫øm s·ª± gi√∫p ƒë·ª°.'
                });
            }

            // Additional suggestions
            if (totalCredits === 0) {
                suggestions.push({
                    icon: 'üöÄ',
                    title: 'B·∫Øt ƒë·∫ßu h√†nh tr√¨nh',
                    content: 'H√£y th√™m ƒëi·ªÉm s·ªë ƒë·ªÉ b·∫Øt ƒë·∫ßu theo d√µi ti·∫øn ƒë·ªô h·ªçc t·∫≠p c·ªßa b·∫°n!'
                });
            }

            // Study tips
            suggestions.push({
                icon: 'üí°',
                title: 'M·∫πo h·ªçc t·∫≠p',
                content: 'H√£y chia nh·ªè th·ªùi gian h·ªçc, t·∫°o l·ªãch tr√¨nh c·ª• th·ªÉ v√† th∆∞·ªùng xuy√™n √¥n t·∫≠p ƒë·ªÉ ƒë·∫°t k·∫øt qu·∫£ t·ªët nh·∫•t.'
            });

            container.innerHTML = suggestions.map(suggestion => `
                <div class="suggestion-item">
                    <strong>${suggestion.icon} ${suggestion.title}:</strong> ${suggestion.content}
                </div>
            `).join('');
        }

        function openChatModal() {
            document.getElementById('chatModal').style.display = 'block';
        }

        function closeChatModal() {
            document.getElementById('chatModal').style.display = 'none';
        }

        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            const chatMessages = document.getElementById('chatMessages');
            
            // Add user message
            chatMessages.innerHTML += `
                <div style="margin-bottom: 10px; text-align: right;">
                    <strong style="color: #63b3ed;">B·∫°n:</strong> ${message}
                </div>
            `;

            // Generate AI response
            const response = generateAIResponse(message);
            chatMessages.innerHTML += `
                <div style="margin-bottom: 10px; color: #4fd1c7;">
                    <strong>AI Assistant:</strong> ${response}
                </div>
            `;

            input.value = '';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Calculate current stats for context
            let totalCredits = 0;
            let totalGradePoints = 0;
            let totalSubjects = 0;
            
            for (let semester = 1; semester <= 8; semester++) {
                semesterData[semester].forEach(subject => {
                    totalCredits += subject.credits;
                    totalGradePoints += subject.gpa4 * subject.credits;
                    totalSubjects++;
                });
            }
            
            const currentGPA = totalCredits > 0 ? (totalGradePoints / totalCredits) : 0;

            if (lowerMessage.includes('gpa') || lowerMessage.includes('ƒëi·ªÉm')) {
                return `GPA hi·ªán t·∫°i c·ªßa b·∫°n l√† ${currentGPA.toFixed(2)}/4.0. ${currentGPA >= 3.5 ? 'R·∫•t t·ªët!' : currentGPA >= 3.0 ? 'Kh√° t·ªët, h√£y c·ªë g·∫Øng th√™m!' : 'C·∫ßn c·∫£i thi·ªán, ƒë·ª´ng n·∫£n l√≤ng!'}`;
            }
            
            if (lowerMessage.includes('c·∫£i thi·ªán') || lowerMessage.includes('tƒÉng')) {
                return 'ƒê·ªÉ c·∫£i thi·ªán GPA, b·∫°n n√™n: 1) T·∫≠p trung v√†o c√°c m√¥n c√≥ t√≠n ch·ªâ cao, 2) Chu·∫©n b·ªã k·ªπ cho k·ª≥ thi cu·ªëi k·ª≥ (50% ƒëi·ªÉm), 3) Ho√†n th√†nh t·ªët b√†i t·∫≠p v√† tham gia t√≠ch c·ª±c l·ªõp h·ªçc.';
            }
            
            if (lowerMessage.includes('h·ªçc') || lowerMessage.includes('tips')) {
                return 'M·ªôt s·ªë m·∫πo h·ªçc t·∫≠p hi·ªáu qu·∫£: 1) L·∫≠p k·∫ø ho·∫°ch h·ªçc t·∫≠p c·ª• th·ªÉ, 2) √în t·∫≠p th∆∞·ªùng xuy√™n thay v√¨ h·ªçc d·ªìn, 3) Tham gia nh√≥m h·ªçc t·∫≠p, 4) H·ªèi gi·∫£ng vi√™n khi c√≥ th·∫Øc m·∫Øc, 5) Ngh·ªâ ng∆°i ƒë·∫ßy ƒë·ªß.';
            }
            
            if (lowerMessage.includes('th·ªùi gian') || lowerMessage.includes('l·ªãch')) {
                return 'Qu·∫£n l√Ω th·ªùi gian hi·ªáu qu·∫£: 1) S·ª≠ d·ª•ng k·ªπ thu·∫≠t Pomodoro (25 ph√∫t h·ªçc + 5 ph√∫t ngh·ªâ), 2) ∆Øu ti√™n c√°c m√¥n kh√≥ tr∆∞·ªõc, 3) D√†nh 2-3 gi·ªù m·ªói ng√†y cho vi·ªác h·ªçc, 4) Tr√°nh h·ªçc d·ªìn v√†o ph√∫t ch√≥t.';
            }
            
            if (lowerMessage.includes('stress') || lowerMessage.includes('√°p l·ª±c')) {
                return 'ƒê·ªÉ gi·∫£m stress h·ªçc t·∫≠p: 1) Th·ªü s√¢u v√† th∆∞ gi√£n, 2) T·∫≠p th·ªÉ d·ª•c th∆∞·ªùng xuy√™n, 3) Ng·ªß ƒë·ªß 7-8 ti·∫øng/ng√†y, 4) Chia s·∫ª v·ªõi b·∫°n b√® v√† gia ƒë√¨nh, 5) ƒê·∫∑t m·ª•c ti√™u th·ª±c t·∫ø.';
            }
            
            if (lowerMessage.includes('m·ª•c ti√™u') || lowerMessage.includes('target')) {
                return `V·ªõi GPA hi·ªán t·∫°i ${currentGPA.toFixed(2)}, b·∫°n n√™n ƒë·∫∑t m·ª•c ti√™u th·ª±c t·∫ø. H√£y s·ª≠ d·ª•ng t√≠nh nƒÉng "D·ª± ƒëo√°n" ƒë·ªÉ xem ƒëi·ªÉm c·∫ßn thi·∫øt cho m·ª•c ti√™u c·ªßa b·∫°n!`;
            }

            if (lowerMessage.includes('ngo·∫°i ng·ªØ') || lowerMessage.includes('english') || lowerMessage.includes('ti·∫øng anh')) {
                return 'H·ªçc ngo·∫°i ng·ªØ r·∫•t quan tr·ªçng! B·∫°n c√≥ th·ªÉ nh·∫•n n√∫t "Ngo·∫°i ng·ªØ" ·ªü tr√™n ƒë·ªÉ truy c·∫≠p trang h·ªçc ti·∫øng Anh. M·ªôt s·ªë m·∫πo: 1) Luy·ªán nghe h√†ng ng√†y, 2) ƒê·ªçc tin t·ª©c ti·∫øng Anh, 3) Th·ª±c h√†nh n√≥i v·ªõi b·∫°n b√®, 4) S·ª≠ d·ª•ng ·ª©ng d·ª•ng h·ªçc t·ª´ v·ª±ng.';
            }
            
            // Default responses
            const defaultResponses = [
                'T√¥i hi·ªÉu b·∫°n ƒëang quan t√¢m v·ªÅ vi·ªác h·ªçc. H√£y cho t√¥i bi·∫øt c·ª• th·ªÉ h∆°n v·ªÅ v·∫•n ƒë·ªÅ b·∫°n mu·ªën th·∫£o lu·∫≠n!',
                'ƒê√≥ l√† m·ªôt c√¢u h·ªèi hay! B·∫°n c√≥ th·ªÉ h·ªèi t√¥i v·ªÅ GPA, c√°ch c·∫£i thi·ªán ƒëi·ªÉm s·ªë, m·∫πo h·ªçc t·∫≠p, ho·∫∑c qu·∫£n l√Ω th·ªùi gian.',
                'T√¥i ·ªü ƒë√¢y ƒë·ªÉ h·ªó tr·ª£ b·∫°n! H√£y h·ªèi t√¥i v·ªÅ b·∫•t k·ª≥ ƒëi·ªÅu g√¨ li√™n quan ƒë·∫øn vi·ªác h·ªçc v√† GPA c·ªßa b·∫°n.',
                `V·ªõi ${totalSubjects} m√¥n h·ªçc v√† ${totalCredits} t√≠n ch·ªâ, b·∫°n ƒëang c√≥ m·ªôt h√†nh tr√¨nh h·ªçc t·∫≠p th√∫ v·ªã! T√¥i c√≥ th·ªÉ gi√∫p g√¨ th√™m?`
            ];
            
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }

        // Charts Functions
        function showChartsModal() {
            document.getElementById('chartsModal').style.display = 'block';
            updateChartStats();
            createCharts();
        }

        function closeChartsModal() {
            document.getElementById('chartsModal').style.display = 'none';
            // Destroy charts to prevent memory leaks
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};
        }

        function showChartSection(section) {
            document.querySelectorAll('.chart-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.chart-section').forEach(section => section.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(section + 'Charts').classList.add('active');
            
            // Recreate charts for the active section
            setTimeout(() => createCharts(), 100);
        }

        function updateChartStats() {
            let totalCredits = 0;
            let totalGradePoints = 0;
            let highestGPA = 0;
            let lowestGPA = 4;
            let hasData = false;

            for (let semester = 1; semester <= 8; semester++) {
                if (semesterData[semester].length > 0) {
                    hasData = true;
                    let semesterCredits = 0;
                    let semesterGradePoints = 0;
                    
                    semesterData[semester].forEach(subject => {
                        totalCredits += subject.credits;
                        totalGradePoints += subject.gpa4 * subject.credits;
                        semesterCredits += subject.credits;
                        semesterGradePoints += subject.gpa4 * subject.credits;
                    });
                    
                    const semesterGPA = semesterCredits > 0 ? semesterGradePoints / semesterCredits : 0;
                    if (semesterGPA > highestGPA) highestGPA = semesterGPA;
                    if (semesterGPA < lowestGPA) lowestGPA = semesterGPA;
                }
            }

            const currentGPA = totalCredits > 0 ? (totalGradePoints / totalCredits) : 0;
            
            document.getElementById('chartCurrentGPA').textContent = currentGPA.toFixed(2);
            document.getElementById('chartTotalCredits').textContent = totalCredits;
            document.getElementById('chartHighestGPA').textContent = hasData ? highestGPA.toFixed(2) : '0.00';
            document.getElementById('chartLowestGPA').textContent = hasData ? lowestGPA.toFixed(2) : '0.00';
        }

        function createCharts() {
            const activeSection = document.querySelector('.chart-section.active');
            if (!activeSection) return;

            if (activeSection.id === 'overviewCharts') {
                createGradeDistributionChart();
                createGPAProgressChart();
            } else if (activeSection.id === 'semesterCharts') {
                createSemesterGPAChart();
                createSemesterCreditsChart();
            } else if (activeSection.id === 'subjectCharts') {
                createTopSubjectsChart();
                createScoreComponentsChart();
            }
        }

        function createGradeDistributionChart() {
            const ctx = document.getElementById('gradeDistributionChart');
            if (!ctx) return;

            const grades = { 'A (3.7-4.0)': 0, 'B (3.0-3.6)': 0, 'C (2.0-2.9)': 0, 'D (1.0-1.9)': 0, 'F (0.0-0.9)': 0 };
            
            for (let semester = 1; semester <= 8; semester++) {
                semesterData[semester].forEach(subject => {
                    if (subject.gpa4 >= 3.7) grades['A (3.7-4.0)']++;
                    else if (subject.gpa4 >= 3.0) grades['B (3.0-3.6)']++;
                    else if (subject.gpa4 >= 2.0) grades['C (2.0-2.9)']++;
                    else if (subject.gpa4 >= 1.0) grades['D (1.0-1.9)']++;
                    else grades['F (0.0-0.9)']++;
                });
            }

            if (charts.gradeDistribution) charts.gradeDistribution.destroy();
            
            charts.gradeDistribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(grades),
                    datasets: [{
                        data: Object.values(grades),
                        backgroundColor: ['#4fd1c7', '#63b3ed', '#90cdf4', '#f6ad55', '#f56565'],
                        borderColor: '#1a365d',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0' }
                        }
                    }
                }
            });
        }

        function createGPAProgressChart() {
            const ctx = document.getElementById('gpaProgressChart');
            if (!ctx) return;

            const semesterLabels = [];
            const gpaData = [];
            
            for (let semester = 1; semester <= 8; semester++) {
                if (semesterData[semester].length > 0) {
                    let credits = 0;
                    let gradePoints = 0;
                    
                    semesterData[semester].forEach(subject => {
                        credits += subject.credits;
                        gradePoints += subject.gpa4 * subject.credits;
                    });
                    
                    semesterLabels.push(`HK ${semester}`);
                    gpaData.push(credits > 0 ? (gradePoints / credits) : 0);
                }
            }

            if (charts.gpaProgress) charts.gpaProgress.destroy();
            
            charts.gpaProgress = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: semesterLabels,
                    datasets: [{
                        label: 'GPA',
                        data: gpaData,
                        borderColor: '#4fd1c7',
                        backgroundColor: 'rgba(79, 209, 199, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(79, 209, 199, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(79, 209, 199, 0.1)' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0' }
                        }
                    }
                }
            });
        }

        function createSemesterGPAChart() {
            const ctx = document.getElementById('semesterGPAChart');
            if (!ctx) return;

            const labels = [];
            const data = [];
            
            for (let semester = 1; semester <= 8; semester++) {
                labels.push(`HK ${semester}`);
                if (semesterData[semester].length > 0) {
                    let credits = 0;
                    let gradePoints = 0;
                    
                    semesterData[semester].forEach(subject => {
                        credits += subject.credits;
                        gradePoints += subject.gpa4 * subject.credits;
                    });
                    
                    data.push(credits > 0 ? (gradePoints / credits) : 0);
                } else {
                    data.push(0);
                }
            }

            if (charts.semesterGPA) charts.semesterGPA.destroy();
            
            charts.semesterGPA = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'GPA theo h·ªçc k·ª≥',
                        data: data,
                        backgroundColor: 'rgba(79, 209, 199, 0.8)',
                        borderColor: '#4fd1c7',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(79, 209, 199, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(79, 209, 199, 0.1)' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0' }
                        }
                    }
                }
            });
        }

        function createSemesterCreditsChart() {
            const ctx = document.getElementById('semesterCreditsChart');
            if (!ctx) return;

            const labels = [];
            const data = [];
            
            for (let semester = 1; semester <= 8; semester++) {
                labels.push(`HK ${semester}`);
                let credits = 0;
                semesterData[semester].forEach(subject => {
                    credits += subject.credits;
                });
                data.push(credits);
            }

            if (charts.semesterCredits) charts.semesterCredits.destroy();
            
            charts.semesterCredits = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'S·ªë t√≠n ch·ªâ',
                        data: data,
                        backgroundColor: 'rgba(99, 179, 237, 0.8)',
                        borderColor: '#63b3ed',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(79, 209, 199, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(79, 209, 199, 0.1)' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0' }
                        }
                    }
                }
            });
        }

        function createTopSubjectsChart() {
            const ctx = document.getElementById('topSubjectsChart');
            if (!ctx) return;

            const allSubjects = [];
            for (let semester = 1; semester <= 8; semester++) {
                allSubjects.push(...semesterData[semester]);
            }
            
            const topSubjects = allSubjects
                .sort((a, b) => b.average - a.average)
                .slice(0, 10);

            if (charts.topSubjects) charts.topSubjects.destroy();
            
            charts.topSubjects = new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: topSubjects.map(s => s.name.length > 15 ? s.name.substring(0, 15) + '...' : s.name),
                    datasets: [{
                        label: 'ƒêi·ªÉm trung b√¨nh',
                        data: topSubjects.map(s => s.average),
                        backgroundColor: 'rgba(79, 209, 199, 0.8)',
                        borderColor: '#4fd1c7',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 10,
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(79, 209, 199, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(79, 209, 199, 0.1)' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0' }
                        }
                    }
                }
            });
        }

        function createScoreComponentsChart() {
            const ctx = document.getElementById('scoreComponentsChart');
            if (!ctx) return;

            let totalAttendance = 0, totalHomework = 0, totalMidterm = 0, totalFinal = 0, count = 0;
            
            for (let semester = 1; semester <= 8; semester++) {
                semesterData[semester].forEach(subject => {
                    totalAttendance += subject.attendance;
                    totalHomework += subject.homework;
                    totalMidterm += subject.midterm;
                    totalFinal += subject.final;
                    count++;
                });
            }

            if (count === 0) return;

            const avgAttendance = totalAttendance / count;
            const avgHomework = totalHomework / count;
            const avgMidterm = totalMidterm / count;
            const avgFinal = totalFinal / count;

            if (charts.scoreComponents) charts.scoreComponents.destroy();
            
            charts.scoreComponents = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Chuy√™n c·∫ßn', 'B√†i t·∫≠p', 'Gi·ªØa k·ª≥', 'Cu·ªëi k·ª≥'],
                    datasets: [{
                        label: 'ƒêi·ªÉm trung b√¨nh',
                        data: [avgAttendance, avgHomework, avgMidterm, avgFinal],
                        backgroundColor: 'rgba(79, 209, 199, 0.2)',
                        borderColor: '#4fd1c7',
                        borderWidth: 2,
                        pointBackgroundColor: '#4fd1c7'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: { color: '#e2e8f0' },
                            grid: { color: 'rgba(79, 209, 199, 0.1)' },
                            pointLabels: { color: '#e2e8f0' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0' }
                        }
                    }
                }
            });
        }

        function calculatePrediction() {
            const targetGPA = parseFloat(document.getElementById('targetGPA').value);
            if (isNaN(targetGPA) || targetGPA < 0 || targetGPA > 4) {
                document.getElementById('predictionResults').innerHTML = 
                    '<p style="color: #f56565; text-align: center;">Vui l√≤ng nh·∫≠p GPA m·ª•c ti√™u h·ª£p l·ªá (0-4)!</p>';
                return;
            }

            let totalCredits = 0;
            let totalGradePoints = 0;
            
            for (let semester = 1; semester <= 8; semester++) {
                semesterData[semester].forEach(subject => {
                    totalCredits += subject.credits;
                    totalGradePoints += subject.gpa4 * subject.credits;
                });
            }

            const currentGPA = totalCredits > 0 ? (totalGradePoints / totalCredits) : 0;
            
            if (currentGPA >= targetGPA) {
                document.getElementById('predictionResults').innerHTML = `
                    <div style="text-align: center;">
                        <h4 style="color: #48bb78; margin-bottom: 15px;">üéâ Ch√∫c m·ª´ng!</h4>
                        <p>B·∫°n ƒë√£ ƒë·∫°t ƒë∆∞·ª£c GPA m·ª•c ti√™u ${targetGPA.toFixed(2)}!</p>
                        <p>GPA hi·ªán t·∫°i: <strong style="color: #4fd1c7;">${currentGPA.toFixed(2)}</strong></p>
                        <p style="margin-top: 15px; color: #cbd5e0;">H√£y duy tr√¨ phong ƒë·ªô n√†y ƒë·ªÉ gi·ªØ v·ªØng th√†nh t√≠ch!</p>
                    </div>
                `;
                return;
            }

            // Calculate credits needed for different scenarios
            const creditsNeeded15 = 15; // Assume 15 credits for next semester
            const creditsNeeded30 = 30; // Assume 30 credits for next year
            
            const gpaNeeded15 = ((targetGPA * (totalCredits + creditsNeeded15)) - totalGradePoints) / creditsNeeded15;
            const gpaNeeded30 = ((targetGPA * (totalCredits + creditsNeeded30)) - totalGradePoints) / creditsNeeded30;

            document.getElementById('predictionResults').innerHTML = `
                <div>
                    <h4 style="color: #4fd1c7; margin-bottom: 15px;">üìä Ph√¢n t√≠ch d·ª± ƒëo√°n</h4>
                    <div style="margin-bottom: 15px;">
                        <strong>GPA hi·ªán t·∫°i:</strong> <span style="color: #4fd1c7;">${currentGPA.toFixed(2)}</span><br>
                        <strong>GPA m·ª•c ti√™u:</strong> <span style="color: #48bb78;">${targetGPA.toFixed(2)}</span><br>
                        <strong>Ch√™nh l·ªách:</strong> <span style="color: #ed8936;">${(targetGPA - currentGPA).toFixed(2)}</span>
                    </div>
                    
                    <div style="background: rgba(26, 54, 93, 0.6); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #63b3ed; margin-bottom: 10px;">K·ªãch b·∫£n 1: H·ªçc k·ª≥ ti·∫øp theo (15 t√≠n ch·ªâ)</h5>
                        <p>GPA c·∫ßn ƒë·∫°t: <strong style="color: ${gpaNeeded15 <= 4 ? '#4fd1c7' : '#f56565'}">${gpaNeeded15.toFixed(2)}</strong></p>
                        <p style="font-size: 14px; color: #a0aec0;">
                            ${gpaNeeded15 <= 4 ? '‚úÖ Kh·∫£ thi' : '‚ùå Kh√¥ng kh·∫£ thi v·ªõi 15 t√≠n ch·ªâ'}
                        </p>
                    </div>
                    
                    <div style="background: rgba(26, 54, 93, 0.6); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #63b3ed; margin-bottom: 10px;">K·ªãch b·∫£n 2: NƒÉm h·ªçc ti·∫øp theo (30 t√≠n ch·ªâ)</h5>
                        <p>GPA c·∫ßn ƒë·∫°t: <strong style="color: ${gpaNeeded30 <= 4 ? '#4fd1c7' : '#f56565'}">${gpaNeeded30.toFixed(2)}</strong></p>
                        <p style="font-size: 14px; color: #a0aec0;">
                            ${gpaNeeded30 <= 4 ? '‚úÖ Kh·∫£ thi' : '‚ùå C·∫ßn xem x√©t l·∫°i m·ª•c ti√™u'}
                        </p>
                    </div>
                    
                    <div style="background: rgba(79, 209, 199, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(79, 209, 199, 0.3);">
                        <h5 style="color: #4fd1c7; margin-bottom: 10px;">üí° L·ªùi khuy√™n</h5>
                        <ul style="margin: 0; padding-left: 20px; color: #cbd5e0; line-height: 1.6;">
                            ${gpaNeeded15 <= 4 ? 
                                                                '<li>T·∫≠p trung v√†o c√°c m√¥n c√≥ t√≠n ch·ªâ cao</li><li>Chu·∫©n b·ªã k·ªπ cho k·ª≥ thi cu·ªëi k·ª≥ (50% ƒëi·ªÉm)</li><li>Tham gia t√≠ch c·ª±c c√°c ho·∫°t ƒë·ªông l·ªõp h·ªçc</li>' :
                                '<li>C√¢n nh·∫Øc gi·∫£m m·ª•c ti√™u GPA xu·ªëng m·ª©c th·ª±c t·∫ø h∆°n</li><li>T·∫≠p trung c·∫£i thi·ªán t·ª´ng m√¥n m·ªôt c√°ch b·ªÅn v·ªØng</li><li>T√¨m ki·∫øm s·ª± h·ªó tr·ª£ t·ª´ gi·∫£ng vi√™n v√† b·∫°n b√®</li>'
                            }
                        </ul>
                    </div>
                </div>
            `;
        }

        // Help Modal Functions
        function showHelpModal() {
            document.getElementById('helpModal').style.display = 'block';
        }

        function closeHelpModal() {
            document.getElementById('helpModal').style.display = 'none';
        }

        function closeAllModals() {
            closeChatModal();
            closeChartsModal();
            closeHelpModal();
        }

        // Language Page Function
        function openLanguagePage() {
            // You can replace this URL with your actual English learning page
            const languagePageURL = 'https://your-english-learning-site.com';
            
            // For demo purposes, we'll show a modal with language learning resources
            showLanguageModal();
        }

        function showLanguageModal() {
            // Create a temporary modal for language learning
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="closeLanguageModal()">&times;</span>
                    <h2><i class="fas fa-globe"></i> Trang h·ªçc ngo·∫°i ng·ªØ</h2>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <h3 style="color: #4fd1c7; margin-bottom: 20px;">üåü T√†i nguy√™n h·ªçc ti·∫øng Anh mi·ªÖn ph√≠</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                            <div class="language-resource-card">
                                <h4><i class="fas fa-book"></i> T·ª´ v·ª±ng</h4>
                                <p>H·ªçc t·ª´ v·ª±ng theo ch·ªß ƒë·ªÅ v·ªõi flashcards t∆∞∆°ng t√°c</p>
                                <button class="btn btn-primary" onclick="openExternalLink('https://letu18.github.io/English/')">
                                    <i class="fas fa-external-link-alt"></i> Quizlet
                                </button>
                            </div>
                            
                            <div class="language-resource-card">
                                <h4><i class="fas fa-headphones"></i> Nghe</h4>
                                <p>Luy·ªán nghe v·ªõi podcast v√† video c√≥ ph·ª• ƒë·ªÅ</p>
                                <button class="btn btn-primary" onclick="openExternalLink('https://www.ted.com/talks')">
                                    <i class="fas fa-external-link-alt"></i> TED Talks
                                </button>
                            </div>
                            
                            <div class="language-resource-card">
                                <h4><i class="fas fa-comments"></i> N√≥i</h4>
                                <p>Th·ª±c h√†nh giao ti·∫øp v·ªõi ng∆∞·ªùi b·∫£n ng·ªØ</p>
                                <button class="btn btn-primary" onclick="openExternalLink('https://www.cambly.com')">
                                    <i class="fas fa-external-link-alt"></i> Cambly
                                </button>
                            </div>
                            
                            <div class="language-resource-card">
                                <h4><i class="fas fa-newspaper"></i> ƒê·ªçc</h4>
                                <p>ƒê·ªçc tin t·ª©c v√† b√†i vi·∫øt ti·∫øng Anh</p>
                                <button class="btn btn-primary" onclick="openExternalLink('https://www.bbc.com/learningenglish')">
                                    <i class="fas fa-external-link-alt"></i> BBC Learning
                                </button>
                            </div>
                            
                            <div class="language-resource-card">
                                <h4><i class="fas fa-pen"></i> Vi·∫øt</h4>
                                <p>C·∫£i thi·ªán k·ªπ nƒÉng vi·∫øt v·ªõi b√†i t·∫≠p th·ª±c h√†nh</p>
                                <button class="btn btn-primary" onclick="openExternalLink('https://www.grammarly.com')">
                                    <i class="fas fa-external-link-alt"></i> Grammarly
                                </button>
                            </div>
                            
                            <div class="language-resource-card">
                                <h4><i class="fas fa-gamepad"></i> Game</h4>
                                <p>H·ªçc ti·∫øng Anh qua tr√≤ ch∆°i vui nh·ªôn</p>
                                <button class="btn btn-primary" onclick="openExternalLink('https://letu18.github.io/English/')">
                                    <i class="fas fa-external-link-alt"></i> letu
                                </button>
                            </div>
                        </div>
                        
                        <div style="background: rgba(79, 209, 199, 0.1); padding: 20px; border-radius: 10px; border: 1px solid rgba(79, 209, 199, 0.3); margin: 20px 0;">
                            <h4 style="color: #4fd1c7; margin-bottom: 15px;">üí° M·∫πo h·ªçc ti·∫øng Anh hi·ªáu qu·∫£</h4>
                            <ul style="text-align: left; color: #cbd5e0; line-height: 1.8;">
                                <li><strong>Th·ª±c h√†nh h√†ng ng√†y:</strong> D√†nh √≠t nh·∫•t 30 ph√∫t m·ªói ng√†y</li>
                                <li><strong>Nghe nh·∫°c v√† xem phim:</strong> C√≥ ph·ª• ƒë·ªÅ ti·∫øng Anh</li>
                                <li><strong>Ghi ch√©p t·ª´ m·ªõi:</strong> H·ªçc 5-10 t·ª´ m·ªõi m·ªói ng√†y</li>
                                <li><strong>N√≥i to:</strong> Luy·ªán ph√°t √¢m tr∆∞·ªõc g∆∞∆°ng</li>
                                <li><strong>Tham gia c·ªông ƒë·ªìng:</strong> T√¨m nh√≥m h·ªçc ti·∫øng Anh</li>
                                <li><strong>ƒê·∫∑t m·ª•c ti√™u:</strong> IELTS, TOEIC, TOEFL</li>
                            </ul>
                        </div>
                        
                        <div style="background: rgba(26, 54, 93, 0.6); padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h4 style="color: #63b3ed; margin-bottom: 15px;">üìö L·ªô tr√¨nh h·ªçc theo tr√¨nh ƒë·ªô</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="background: rgba(79, 209, 199, 0.2); padding: 15px; border-radius: 8px;">
                                    <h5 style="color: #4fd1c7;">Beginner (A1-A2)</h5>
                                    <p style="font-size: 14px; color: #cbd5e0;">T·ª´ v·ª±ng c∆° b·∫£n, ng·ªØ ph√°p ƒë∆°n gi·∫£n</p>
                                </div>
                                <div style="background: rgba(99, 179, 237, 0.2); padding: 15px; border-radius: 8px;">
                                    <h5 style="color: #63b3ed;">Intermediate (B1-B2)</h5>
                                    <p style="font-size: 14px; color: #cbd5e0;">Giao ti·∫øp th√¥ng th·∫°o, ƒë·ªçc hi·ªÉu</p>
                                </div>
                                <div style="background: rgba(144, 205, 244, 0.2); padding: 15px; border-radius: 8px;">
                                    <h5 style="color: #90cdf4;">Advanced (C1-C2)</h5>
                                    <p style="font-size: 14px; color: #cbd5e0;">Th√†nh th·∫°o, thi ch·ª©ng ch·ªâ qu·ªëc t·∫ø</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add styles for language resource cards
            const style = document.createElement('style');
            style.textContent = `
                .language-resource-card {
                    background: rgba(26, 54, 93, 0.6);
                    border: 1px solid rgba(79, 209, 199, 0.2);
                    padding: 20px;
                    border-radius: 10px;
                    text-align: center;
                    transition: all 0.3s ease;
                }
                .language-resource-card:hover {
                    border-color: #4fd1c7;
                    transform: translateY(-2px);
                    box-shadow: 0 10px 25px rgba(79, 209, 199, 0.2);
                }
                .language-resource-card h4 {
                    color: #4fd1c7;
                    margin-bottom: 10px;
                }
                .language-resource-card p {
                    color: #cbd5e0;
                    margin-bottom: 15px;
                    font-size: 14px;
                }
            `;
            document.head.appendChild(style);
        }

        function closeLanguageModal() {
            const modal = document.querySelector('.modal:last-child');
            if (modal) {
                modal.remove();
            }
        }

        function openExternalLink(url) {
            window.open(url, '_blank');
        }

        // Additional utility functions
        function formatNumber(num) {
            return new Intl.NumberFormat('vi-VN').format(num);
        }

        function getMotivationalQuote() {
            const quotes = [
                "Th√†nh c√¥ng l√† t·ªïng c·ªßa nh·ªØng n·ªó l·ª±c nh·ªè l·∫∑p ƒëi l·∫∑p l·∫°i m·ªói ng√†y.",
                "H·ªçc t·∫≠p kh√¥ng ph·∫£i l√† chu·∫©n b·ªã cho cu·ªôc s·ªëng; h·ªçc t·∫≠p ch√≠nh l√† cu·ªôc s·ªëng.",
                "Ki·∫øn th·ª©c l√† s·ª©c m·∫°nh, nh∆∞ng vi·ªác √°p d·ª•ng ki·∫øn th·ª©c m·ªõi l√† si√™u nƒÉng l·ª±c.",
                "M·ªói chuy√™n gia ƒë·ªÅu t·ª´ng l√† ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu.",
                "ƒê·ª´ng so s√°nh ti·∫øn b·ªô c·ªßa b·∫°n v·ªõi ng∆∞·ªùi kh√°c. H√£y so s√°nh v·ªõi ch√≠nh b·∫£n th√¢n ng√†y h√¥m qua."
            ];
            return quotes[Math.floor(Math.random() * quotes.length)];
        }

        // Add motivational quote to suggestions periodically
        setInterval(() => {
            const suggestionsContent = document.getElementById('suggestionsContent');
            if (suggestionsContent && Math.random() < 0.3) { // 30% chance
                const quote = getMotivationalQuote();
                const quoteElement = document.createElement('div');
                quoteElement.className = 'suggestion-item';
                quoteElement.innerHTML = `<strong>üí™ ƒê·ªông l·ª±c:</strong> ${quote}`;
                quoteElement.style.animation = 'slideIn 0.5s ease-out';
                
                suggestionsContent.appendChild(quoteElement);
                
                // Remove after 10 seconds
                setTimeout(() => {
                    if (quoteElement.parentNode) {
                        quoteElement.remove();
                    }
                }, 10000);
            }
        }, 30000); // Every 30 seconds

        // Performance optimization: Debounce function for input events
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Apply debouncing to average calculation
        const debouncedCalculateAverage = debounce(calculateAverage, 300);
        ['attendance', 'homework', 'midterm', 'final'].forEach(id => {
            document.getElementById(id).removeEventListener('input', calculateAverage);
            document.getElementById(id).addEventListener('input', debouncedCalculateAverage);
        });

        // Add smooth scrolling for better UX
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add loading states for better UX
        function showLoading(element) {
            const originalContent = element.innerHTML;
            element.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang x·ª≠ l√Ω...';
            element.disabled = true;
            
            return () => {
                element.innerHTML = originalContent;
                element.disabled = false;
            };
        }

        // Enhanced error handling
        window.addEventListener('error', function(e) {
            console.error('Application error:', e.error);
            showAlert('warning', 'ƒê√£ x·∫£y ra l·ªói. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c t·∫£i l·∫°i trang.');
        });

        // Add keyboard navigation for accessibility
        document.addEventListener('keydown', function(e) {
            if (e.altKey && e.key >= '1' && e.key <= '8') {
                e.preventDefault();
                const semesterNumber = parseInt(e.key);
                const tab = document.querySelector(`[data-semester="${semesterNumber}"]`);
                if (tab) {
                    tab.click();
                }
            }
        });

        // Initialize tooltips
        function initializeTooltips() {
            document.querySelectorAll('[data-tooltip]').forEach(element => {
                element.style.position = 'relative';
                element.classList.add('tooltip');
            });
        }

        // Call initialization functions
        document.addEventListener('DOMContentLoaded', function() {
            initializeTooltips();
            
            // Add welcome message
            setTimeout(() => {
                if (Object.values(semesterData).every(semester => semester.length === 0)) {
                    showAlert('success', 'Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi HUB GPA Calculator! H√£y b·∫Øt ƒë·∫ßu b·∫±ng c√°ch th√™m m√¥n h·ªçc ƒë·∫ßu ti√™n.');
                }
            }, 1000);
        });

        // Export functions for global access
        window.gpaCalculator = {
            addSubject,
            deleteSubject,
            exportData,
            importData,
            resetAllData,
            showChartsModal,
            openLanguagePage,
            calculatePrediction
        };

        // Service Worker registration for offline support (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>



