<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUB GPA Calculator - Tính Điểm GPA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c1821 0%, #1e3a5f 25%, #2c5f7c 50%, #0f2027 75%, #203a43 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #e8f4f8;
            position: relative;
        }

        /* International theme overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 123, 191, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 191, 165, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 150, 136, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            color: #e8f4f8;
            margin-bottom: 30px;
            background: rgba(12, 24, 33, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(0, 191, 165, 0.2);
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            background: linear-gradient(45deg, #00bfa5, #0077be, #004d7a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            color: #b0d4db;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(12, 24, 33, 0.8);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.3),
                0 5px 15px rgba(0, 191, 165, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 191, 165, 0.2);
            color: #e8f4f8;
        }

        .card h3 {
            color: #00bfa5;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            font-size: 1.5em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .card h3 i {
            margin-right: 10px;
            color: #0077be;
        }

        /* Semester Tabs */
        .semester-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            background: rgba(12, 24, 33, 0.6);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(0, 191, 165, 0.2);
        }

        .tab {
            padding: 12px 20px;
            background: rgba(30, 58, 95, 0.6);
            border: 1px solid rgba(0, 191, 165, 0.3);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #b0d4db;
        }

        .tab.active {
            background: linear-gradient(45deg, #00bfa5, #0077be);
            color: white;
            box-shadow: 
                0 5px 15px rgba(0, 191, 165, 0.4),
                0 0 20px rgba(0, 191, 165, 0.2);
            transform: translateY(-2px);
            border-color: transparent;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 191, 165, 0.3);
            background: rgba(0, 191, 165, 0.2);
            color: #e8f4f8;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #00bfa5;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(0, 191, 165, 0.3);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(30, 58, 95, 0.3);
            color: #e8f4f8;
            backdrop-filter: blur(10px);
        }

        .form-group input::placeholder {
            color: #7a9ca5;
        }

        .form-group input:focus {
            outline: none;
            border-color: #00bfa5;
            box-shadow: 
                0 0 0 3px rgba(0, 191, 165, 0.2),
                0 0 15px rgba(0, 191, 165, 0.1);
            background: rgba(30, 58, 95, 0.5);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            margin: 5px;
            backdrop-filter: blur(10px);
            border: 1px solid transparent;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00bfa5, #0077be);
            color: white;
            border-color: rgba(0, 191, 165, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #00bfa5, #004d7a);
            color: white;
            border-color: rgba(0, 191, 165, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #d32f2f, #b71c1c);
            color: white;
            border-color: rgba(211, 47, 47, 0.3);
        }

        .btn-foreign {
            background: linear-gradient(45deg, #1e3a5f, #2c5f7c);
            color: #e8f4f8;
            border-color: rgba(0, 191, 165, 0.4);
            box-shadow: 0 0 15px rgba(0, 191, 165, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 191, 165, 0.2);
        }

        .btn-foreign:hover {
            background: linear-gradient(45deg, #00bfa5, #0077be);
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.3),
                0 0 25px rgba(0, 191, 165, 0.4);
        }

        /* Average Display */
        .average-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #00bfa5, #0077be);
            color: white;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 
                0 5px 15px rgba(0, 191, 165, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* Subject List */
        .subjects-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .subjects-list::-webkit-scrollbar {
            width: 8px;
        }

        .subjects-list::-webkit-scrollbar-track {
            background: rgba(30, 58, 95, 0.3);
            border-radius: 4px;
        }

        .subjects-list::-webkit-scrollbar-thumb {
            background: rgba(0, 191, 165, 0.5);
            border-radius: 4px;
        }

        .subject-item {
            display: grid;
            grid-template-columns: 2fr 3fr 1fr 1fr 1fr 1fr;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: rgba(30, 58, 95, 0.4);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 191, 165, 0.1);
        }

        .subject-item:hover {
            background: rgba(0, 191, 165, 0.1);
            transform: translateX(5px);
            border-color: rgba(0, 191, 165, 0.3);
        }

        .subject-scores {
            display: flex;
            gap: 10px;
        }

        .score-item {
            background: rgba(12, 24, 33, 0.6);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            color: #b0d4db;
            border: 1px solid rgba(0, 191, 165, 0.2);
        }

        /* Grade Levels */
        .grade-level {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }

        .grade-excellent { 
            background: linear-gradient(45deg, #00bfa5, #004d7a); 
            color: white; 
            box-shadow: 0 2px 8px rgba(0, 191, 165, 0.3);
        }
        .grade-good { 
            background: linear-gradient(45deg, #0077be, #1e3a5f); 
            color: white; 
            box-shadow: 0 2px 8px rgba(0, 119, 190, 0.3);
        }
        .grade-fair { 
            background: linear-gradient(45deg, #2c5f7c, #1e3a5f); 
            color: white; 
            box-shadow: 0 2px 8px rgba(44, 95, 124, 0.3);
        }
        .grade-average { 
            background: linear-gradient(45deg, #004d7a, #0c1821); 
            color: white; 
            box-shadow: 0 2px 8px rgba(0, 77, 122, 0.3);
        }
        .grade-poor { 
            background: linear-gradient(45deg, #37474f, #263238); 
            color: white; 
            box-shadow: 0 2px 8px rgba(55, 71, 79, 0.3);
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(12, 24, 33, 0.8);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.3),
                0 5px 15px rgba(0, 191, 165, 0.1);
            border: 1px solid rgba(0, 191, 165, 0.2);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #00bfa5;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .stat-label {
            color: #b0d4db;
            font-weight: 500;
        }

        /* GPA Progress */
        .gpa-progress {
            background: rgba(30, 58, 95, 0.4);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            border: 1px solid rgba(0, 191, 165, 0.2);
        }

        .gpa-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #00bfa5, #0077be);
            transition: width 0.5s ease;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 191, 165, 0.3);
        }

        /* Year Overview */
        .year-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .year-item {
            background: rgba(30, 58, 95, 0.4);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(0, 191, 165, 0.2);
            transition: all 0.3s ease;
        }

        .year-item:hover {
            background: rgba(0, 191, 165, 0.1);
            border-color: rgba(0, 191, 165, 0.4);
        }

        .year-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #00bfa5;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid transparent;
        }

        .alert-success {
            background: rgba(0, 191, 165, 0.2);
            color: #e8f4f8;
            border-color: rgba(0, 191, 165, 0.4);
            box-shadow: 0 5px 15px rgba(0, 191, 165, 0.1);
        }

        .alert-warning {
            background: rgba(255, 193, 7, 0.2);
            color: #e8f4f8;
            border-color: rgba(255, 193, 7, 0.4);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.1);
        }

        /* AI Suggestions */
        .suggestions-content {
            max-height: 300px;
            overflow-y: auto;
        }

        .suggestion-item {
            background: rgba(30, 58, 95, 0.4);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #00bfa5;
            border: 1px solid rgba(0, 191, 165, 0.2);
            color: #e8f4f8;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(12, 24, 33, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: rgba(12, 24, 33, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            margin: 50px auto;
            position: relative;
            border: 1px solid rgba(0, 191, 165, 0.3);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.5),
                0 0 30px rgba(0, 191, 165, 0.1);
            color: #e8f4f8;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #b0d4db;
            transition: all 0.3s ease;
        }

        .close:hover {
            color: #00bfa5;
            text-shadow: 0 0 10px rgba(0, 191, 165, 0.5);
        }

        /* Chat Messages */
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(0, 191, 165, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            background: rgba(30, 58, 95, 0.3);
            backdrop-filter: blur(10px);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input-container input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid rgba(0, 191, 165, 0.3);
            border-radius: 25px;
            font-size: 16px;
            background: rgba(30, 58, 95, 0.3);
            color: #e8f4f8;
            backdrop-filter: blur(10px);
        }

        /* Charts Modal */
        .charts-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(12, 24, 33, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1001;
            overflow-y: auto;
        }

        .charts-modal-content {
            background: rgba(12, 24, 33, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            max-width: 1200px;
            margin: 20px auto;
            position: relative;
            min-height: 80vh;
            border: 1px solid rgba(0, 191, 165, 0.3);
            color: #e8f4f8;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .chart-container {
            background: rgba(30, 58, 95, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 
                0 5px 15px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(0, 191, 165, 0.1);
            position: relative;
            height: 400px;
            border: 1px solid rgba(0, 191, 165, 0.2);
        }

        .chart-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-item {
            background: linear-gradient(135deg, #00bfa5, #0077be);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 191, 165, 0.3);
        }

        .chart-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: rgba(30, 58, 95, 0.3);
            border-radius: 10px;
            padding: 5px;
            border: 1px solid rgba(0, 191, 165, 0.2);
        }

        .chart-tab {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            margin: 0 5px;
            color: #b0d4db;
        }

        .chart-tab.active {
            background: linear-gradient(45deg, #00bfa5, #0077be);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 191, 165, 0.3);
        }

        .chart-section {
            display: none;
        }

        .chart-section.active {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .subject-item {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .year-overview {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .semester-tabs {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .card {
            animation: fadeIn 0.5s ease-out;
        }

        /* Tooltips */
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(12, 24, 33, 0.9);
            color: #e8f4f8;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            border: 1px solid rgba(0, 191, 165, 0.3);
            backdrop-filter: blur(10px);
        }

        /* Welcome message */
        kbd {
            background: rgba(0, 191, 165, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
            color: #e8f4f8;
            border: 1px solid rgba(0, 191, 165, 0.3);
        }

        /* International theme elements */
        .international-accent {
            background: linear-gradient(45deg, #00bfa5, #0077be);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Enhanced scrollbars */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 58, 95, 0.3);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #00bfa5, #0077be);
            border-radius: 6px;
            border: 2px solid rgba(12, 24, 33, 0.5);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #0077be, #004d7a);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-graduation-cap"></i> HUB GPA Calculator</h1>
            <p>Hệ thống tính điểm GPA thông minh - Hỗ trợ với AI Assistant</p>
            
            <!-- Action Buttons -->
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="exportData()">
                    <i class="fas fa-download"></i> Xuất dữ liệu
                </button>
                <label class="btn btn-primary" style="cursor: pointer;">
                    <i class="fas fa-upload"></i> Nhập dữ liệu
                    <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                </label>
                <button class="btn btn-primary" onclick="showChartsModal()" style="background: linear-gradient(45deg, #00bfa5, #0077be);">
                    <i class="fas fa-chart-bar"></i> Xem biểu đồ
                </button>
                <button class="btn btn-foreign" onclick="openLanguagePage()">
                    <i class="fas fa-globe"></i> Ngoại ngữ
                </button>
                <button class="btn btn-danger" onclick="resetAllData()" style="background: linear-gradient(45deg, #d32f2f, #b71c1c);">
                    <i class="fas fa-trash-alt"></i> Xóa tất cả
                </button>
                <button class="btn btn-primary" onclick="showHelpModal()" style="background: linear-gradient(45deg, #1e3a5f, #2c5f7c);">
                    <i class="fas fa-question-circle"></i> Hướng dẫn
                </button>
            </div>
        </div>

        <!-- Semester Tabs -->
        <div class="semester-tabs">
            <button class="tab active" data-semester="1">HK 1</button>
            <button class="tab" data-semester="2">HK 2</button>
            <button class="tab" data-semester="3">HK 3</button>
            <button class="tab" data-semester="4">HK 4</button>
            <button class="tab" data-semester="5">HK 5</button>
            <button class="tab" data-semester="6">HK 6</button>
            <button class="tab" data-semester="7">HK 7</button>
            <button class="tab" data-semester="8">HK 8</button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Input Form -->
            <div class="card">
                                <h3><i class="fas fa-plus-circle"></i> Thêm môn học - <span id="currentSemesterTitle">Học kỳ 1</span></h3>
                
                <div class="form-group">
                    <label for="subjectName">Tên môn học:</label>
                    <input type="text" id="subjectName" placeholder="Nhập tên môn học">
                </div>

                <div class="form-group">
                    <label for="credits">Số tín chỉ:</label>
                    <input type="number" id="credits" min="1" max="10" placeholder="Số tín chỉ">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="attendance">Chuyên cần (10%):</label>
                        <input type="number" id="attendance" min="0" max="10" step="0.1" placeholder="0-10" 
                               data-tooltip="Điểm chuyên cần (0-10), chiếm 10% tổng điểm">
                    </div>
                    <div class="form-group">
                        <label for="homework">Bài tập (20%):</label>
                        <input type="number" id="homework" min="0" max="10" step="0.1" placeholder="0-10"
                               data-tooltip="Điểm bài tập (0-10), chiếm 20% tổng điểm">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="midterm">Giữa kỳ (20%):</label>
                        <input type="number" id="midterm" min="0" max="10" step="0.1" placeholder="0-10"
                               data-tooltip="Điểm giữa kỳ (0-10), chiếm 20% tổng điểm">
                    </div>
                    <div class="form-group">
                        <label for="final">Cuối kỳ (50%):</label>
                        <input type="number" id="final" min="0" max="10" step="0.1" placeholder="0-10"
                               data-tooltip="Điểm cuối kỳ (0-10), chiếm 50% tổng điểm">
                    </div>
                </div>

                <div class="average-display" id="averageDisplay">
                    Điểm TB: --
                </div>

                <button class="btn btn-primary" onclick="addSubject()" style="width: 100%;">
                    <i class="fas fa-plus"></i> Thêm môn học
                </button>
            </div>

            <!-- Subject List -->
            <div class="card">
                <h3><i class="fas fa-list"></i> Danh sách môn học</h3>
                <div class="subjects-list" id="subjectsList">
                    <p style="text-align: center; color: #b0d4db; padding: 20px;">
                        Chưa có môn học nào. Hãy thêm môn học đầu tiên!
                    </p>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="currentGPA">0.00</div>
                <div class="stat-label">GPA Học kỳ</div>
                <div class="grade-level" id="currentGrade">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="cumulativeGPA">0.00</div>
                <div class="stat-label">GPA Tích lũy</div>
                <div class="grade-level" id="cumulativeGrade">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCredits">0</div>
                <div class="stat-label">Tổng tín chỉ</div>
                <div class="gpa-progress">
                    <div class="gpa-progress-bar" id="gpaProgress" style="width: 0%"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalSubjects">0</div>
                <div class="stat-label">Tổng môn học</div>
                <button class="btn btn-primary" onclick="predictRequiredScore()" style="margin-top: 10px; font-size: 12px; padding: 8px 12px;">
                    Dự đoán điểm
                </button>
            </div>
        </div>

        <!-- Year Overview -->
        <div class="card">
            <h3><i class="fas fa-calendar-alt"></i> Tổng quan theo năm</h3>
            <div class="year-overview">
                <div class="year-item">
                    <div class="year-number" id="year1GPA">--</div>
                    <div>Năm 1</div>
                </div>
                <div class="year-item">
                    <div class="year-number" id="year2GPA">--</div>
                    <div>Năm 2</div>
                </div>
                <div class="year-item">
                    <div class="year-number" id="year3GPA">--</div>
                    <div>Năm 3</div>
                </div>
                <div class="year-item">
                    <div class="year-number" id="year4GPA">--</div>
                    <div>Năm 4</div>
                </div>
            </div>
        </div>

        <!-- Additional Stats -->
        <div class="card" style="margin-top: 30px;">
            <h3><i class="fas fa-chart-line"></i> Thống kê chi tiết</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <strong>Điểm trung bình:</strong>
                    <span id="averageScore">0.00</span>
                </div>
                <div>
                    <strong>Môn cao nhất:</strong>
                    <span id="highestSubject">--</span>
                </div>
                <div>
                    <strong>Môn thấp nhất:</strong>
                    <span id="lowestSubject">--</span>
                </div>
                <div>
                    <strong>Tổng môn học:</strong>
                    <span id="totalSubjects">0</span>
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 30px;">
            <h3><i class="fas fa-robot"></i> AI Assistant</h3>
            <div class="suggestions-content" id="suggestionsContent">
                <div class="suggestion-item">
                    <i class="fas fa-info-circle" style="margin-right: 10px;"></i>
                    <strong>Bắt đầu nhập điểm:</strong> Hãy thêm các môn học và điểm số để AI có thể phân tích và đưa ra gợi ý phù hợp.
                </div>
            </div>
            <button class="btn btn-primary" onclick="showAIChat()" style="width: 100%; margin-top: 15px;">
                <i class="fas fa-comments"></i> Chat với AI
            </button>
        </div>

        <!-- Alerts -->
        <div class="alert alert-success" id="scholarshipInfo">
            <strong><i class="fas fa-award"></i> Thông báo học bổng:</strong>
            <span id="scholarshipText"></span>
        </div>

        <div class="alert alert-warning" id="warningCard">
            <strong><i class="fas fa-exclamation-triangle"></i> Cảnh báo:</strong>
            <span id="warningText"></span>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div class="modal" id="aiChatModal">
        <div class="modal-content">
            <span class="close" onclick="closeAIChat()">&times;</span>
            <h3><i class="fas fa-robot"></i> AI Assistant - Tư vấn học tập</h3>
            <div class="chat-messages" id="chatMessages">
                <div style="text-align: center; color: #b0d4db; padding: 20px;">
                    <i class="fas fa-robot" style="font-size: 48px; margin-bottom: 15px;"></i>
                    <p>Xin chào! Tôi là AI Assistant. Tôi có thể giúp bạn:</p>
                    <ul style="text-align: left; display: inline-block;">
                        <li>Phân tích kết quả học tập</li>
                        <li>Tư vấn cách cải thiện GPA</li>
                        <li>Thông tin về học bổng</li>
                        <li>Dự đoán điểm cần thiết</li>
                    </ul>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="Nhập câu hỏi của bạn...">
                <button class="btn btn-primary" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Charts Modal -->
    <div class="charts-modal" id="chartsModal">
        <div class="charts-modal-content">
            <span class="close" onclick="closeChartsModal()" style="font-size: 28px;">&times;</span>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: #00bfa5; font-size: 2.5em;">
                    <i class="fas fa-chart-line"></i> Biểu đồ thống kê điểm số
                </h2>
                <p style="color: #b0d4db;">Trực quan hóa kết quả học tập qua 8 học kỳ</p>
            </div>

            <!-- Chart Stats -->
            <div class="chart-stats">
                <div class="stat-item">
                    <div style="font-size: 2em; font-weight: bold; margin-bottom: 5px;" id="totalSubjectsChart">0</div>
                    <div style="font-size: 14px; opacity: 0.9;">Tổng môn học</div>
                </div>
                <div class="stat-item">
                    <div style="font-size: 2em; font-weight: bold; margin-bottom: 5px;" id="avgGPAChart">0.00</div>
                    <div style="font-size: 14px; opacity: 0.9;">GPA trung bình</div>
                </div>
                <div class="stat-item">
                    <div style="font-size: 2em; font-weight: bold; margin-bottom: 5px;" id="totalCreditsChart">0</div>
                    <div style="font-size: 14px; opacity: 0.9;">Tổng tín chỉ</div>
                </div>
                <div class="stat-item">
                    <div style="font-size: 2em; font-weight: bold; margin-bottom: 5px;" id="completedSemestersChart">0</div>
                    <div style="font-size: 14px; opacity: 0.9;">Học kỳ hoàn thành</div>
                </div>
            </div>

            <!-- Chart Tabs -->
            <div class="chart-tabs">
                <div class="chart-tab active" onclick="switchChartTab('overview')">
                    <i class="fas fa-chart-line"></i> Tổng quan
                </div>
                <div class="chart-tab" onclick="switchChartTab('distribution')">
                    <i class="fas fa-chart-pie"></i> Phân bố
                </div>
                <div class="chart-tab" onclick="switchChartTab('comparison')">
                    <i class="fas fa-chart-bar"></i> So sánh
                </div>
                <div class="chart-tab" onclick="switchChartTab('analysis')">
                    <i class="fas fa-chart-area"></i> Phân tích
                </div>
            </div>

            <!-- Chart Sections -->
            <div class="chart-section active" id="overviewSection">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div style="text-align: center; color: #00bfa5; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Xu hướng GPA qua các học kỳ
                        </div>
                        <canvas id="gpaChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div style="text-align: center; color: #00bfa5; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            GPA theo năm học
                        </div>
                        <canvas id="yearlyChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-section" id="distributionSection">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div style="text-align: center; color: #00bfa5; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Phân bố điểm các môn học
                        </div>
                        <canvas id="subjectChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div style="text-align: center; color: #00bfa5; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Phân bố xếp loại
                        </div>
                        <canvas id="gradeChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-section" id="comparisonSection">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div style="text-align: center; color: #00bfa5; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            So sánh điểm trung bình các thành phần
                        </div>
                        <canvas id="componentChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div style="text-align: center; color: #00bfa5; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Tín chỉ theo học kỳ
                        </div>
                        <canvas id="creditsChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-section" id="analysisSection">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div style="text-align: center; color: #00bfa5; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Phân tích xu hướng cải thiện
                        </div>
                        <canvas id="trendChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div style="text-align: center; color: #00bfa5; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Dự đoán GPA tương lai
                        </div>
                        <canvas id="predictionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Global Variables
        let studentData = {
            semesters: {
                1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [], 8: []
            },
            currentSemester: 1
        };

        // Language page function
        function openLanguagePage() {
            // Tạo modal cho trang học tiếng Anh
            const languageModal = document.createElement('div');
            languageModal.className = 'modal';
            languageModal.style.display = 'block';
            languageModal.innerHTML = `
                <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
                    <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2 style="color: #00bfa5; font-size: 2.5em; margin-bottom: 10px;">
                            <i class="fas fa-globe"></i> Ngoại ngữ - English Learning
                        </h2>
                        <p style="color: #b0d4db; font-size: 1.2em;">Nâng cao kỹ năng tiếng Anh cho sinh viên quốc tế</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="card" style="margin: 0;">
                            <h3><i class="fas fa-book-open"></i> Từ vựng học thuật</h3>
                            <div style="margin: 15px 0;">
                                <p><strong>GPA:</strong> Grade Point Average</p>
                                <p><strong>Credit:</strong> Tín chỉ</p>
                                <p><strong>Semester:</strong> Học kỳ</p>
                                <p><strong>Transcript:</strong> Bảng điểm</p>
                                <p><strong>Cumulative:</strong> Tích lũy</p>
                                <p><strong>Academic:</strong> Học thuật</p>
                                <p><strong>Excellence:</strong> Xuất sắc</p>
                                <p><strong>Scholarship:</strong> Học bổng</p>
                            </div>
                        </div>
                        
                        <div class="card" style="margin: 0;">
                            <h3><i class="fas fa-comments"></i> Giao tiếp cơ bản</h3>
                            <div style="margin: 15px 0;">
                                <p><strong>"What's your GPA?"</strong><br>
                                <em>GPA của bạn là bao nhiêu?</em></p>
                                
                                <p><strong>"I'm majoring in..."</strong><br>
                                <em>Tôi học chuyên ngành...</em></p>
                                
                                <p><strong>"How many credits?"</strong><br>
                                <em>Bao nhiêu tín chỉ?</em></p>
                                
                                <p><strong>"I need to improve my grades"</strong><br>
                                <em>Tôi cần cải thiện điểm số</em></p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <div class="card" style="margin: 0;">
                            <h3><i class="fas fa-graduation-cap"></i> Tài nguyên học tập</h3>
                            <div style="margin: 15px 0;">
                                <button class="btn btn-primary" onclick="window.open('https://letu18.github.io/English/', '_blank')" style="width: 100%; margin: 5px 0;">
                                    <i class="fas fa-external-link-alt"></i> Flashcard & Quiz
                                </button>
                                <button class="btn btn-primary" onclick="window.open('https://www.bbc.co.uk/learningenglish', '_blank')" style="width: 100%; margin: 5px 0;">
                                    <i class="fas fa-external-link-alt"></i> BBC Learning English
                                </button>
                                <button class="btn btn-primary" onclick="window.open('https://www.coursera.org/courses?query=english', '_blank')" style="width: 100%; margin: 5px 0;">
                                    <i class="fas fa-external-link-alt"></i> Coursera English
                                </button>
                                <button class="btn btn-primary" onclick="window.open('https://www.edx.org/learn/english', '_blank')" style="width: 100%; margin: 5px 0;">
                                    <i class="fas fa-external-link-alt"></i> edX English
                                </button>
                            </div>
                        </div>
                        
                        <div class="card" style="margin: 0;">
                            <h3><i class="fas fa-certificate"></i> Chứng chỉ quốc tế</h3>
                            <div style="margin: 15px 0;">
                                <div style="background: rgba(0, 191, 165, 0.1); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #00bfa5;">
                                    <strong>IELTS</strong><br>
                                    <small>International English Language Testing System</small>
                                </div>
                                <div style="background: rgba(0, 119, 190, 0.1); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #0077be;">
                                    <strong>TOEFL</strong><br>
                                    <small>Test of English as a Foreign Language</small>
                                </div>
                                <div style="background: rgba(30, 58, 95, 0.1); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 4px solid #1e3a5f;">
                                    <strong>TOEIC</strong><br>
                                    <small>Test of English for International Communication</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin: 0;">
                        <h3><i class="fas fa-clock"></i> Lịch học tiếng Anh hàng ngày</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                            <div style="background: rgba(0, 191, 165, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <strong>Sáng (7:00-8:00)</strong><br>
                                <small>Nghe podcast tiếng Anh</small>
                            </div>
                            <div style="background: rgba(0, 119, 190, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <strong>Trưa (12:00-12:30)</strong><br>
                                <small>Đọc tin tức BBC</small>
                            </div>
                            <div style="background: rgba(30, 58, 95, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <strong>Chiều (17:00-18:00)</strong><br>
                                <small>Học từ vựng mới</small>
                            </div>
                            <div style="background: rgba(44, 95, 124, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <strong>Tối (20:00-21:00)</strong><br>
                                <small>Xem phim có phụ đề</small>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-foreign" onclick="this.parentElement.parentElement.parentElement.remove()" style="font-size: 16px; padding: 12px 30px;">
                            <i class="fas fa-check"></i> Hoàn thành
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(languageModal);
        }

        // Data Management (giữ nguyên tất cả)
        function saveData() {
            localStorage.setItem('hubGPAData', JSON.stringify(studentData));
        }

        function loadData() {
            const saved = localStorage.getItem('hubGPAData');
            if (saved) {
                studentData = JSON.parse(saved);
            }
        }

        // Score Calculations (giữ nguyên hoàn toàn)
        function calculateSubjectScore(attendance, homework, midterm, final) {
            return attendance * 0.1 + homework * 0.2 + midterm * 0.2 + final * 0.5;
        }

        function convertTo4Scale(score10) {
    if (score10 >= 8.95) return 4.0;    // A+
    if (score10 >= 8.45) return 3.7;    // A  
    if (score10 >= 7.95) return 3.5;    // B+
    if (score10 >= 6.95) return 3.0;    // B
    if (score10 >= 6.45) return 2.5;    // C+
    if (score10 >= 5.45) return 2.0;    // C
    if (score10 >= 4.95) return 1.5;    // D+
    if (score10 >= 3.95) return 1.0;    // D
    return 0.0;                          // F
}


        function getGradeLevel(gpa) {
    if (gpa >= 4.0) return { text: 'A+', class: 'grade-excellent' };
    if (gpa >= 3.7) return { text: 'A', class: 'grade-excellent' };
    if (gpa >= 3.5) return { text: 'B+', class: 'grade-good' };
    if (gpa >= 3.0) return { text: 'B', class: 'grade-good' };
    if (gpa >= 2.5) return { text: 'C+', class: 'grade-fair' };
    if (gpa >= 2.0) return { text: 'C', class: 'grade-fair' };
    if (gpa >= 1.5) return { text: 'D+', class: 'grade-average' };
    if (gpa >= 1.0) return { text: 'D', class: 'grade-average' };
    return { text: 'F', class: 'grade-poor' };
}


        // Real-time score calculation (giữ nguyên)
        function updateRealTimeScore() {
            const attendance = parseFloat(document.getElementById('attendance').value) || 0;
            const homework = parseFloat(document.getElementById('homework').value) || 0;
            const midterm = parseFloat(document.getElementById('midterm').value) || 0;
            const final = parseFloat(document.getElementById('final').value) || 0;

            const totalScore = calculateSubjectScore(attendance, homework, midterm, final);
            const gpa4 = convertTo4Scale(totalScore);
            const grade = getGradeLevel(gpa4);

            const display = document.getElementById('averageDisplay');
            display.textContent = `Điểm TB: ${totalScore.toFixed(2)} (GPA: ${gpa4.toFixed(2)} - ${grade.text})`;
            display.style.background = `linear-gradient(45deg, ${getGradeColor(gpa4)})`;
        }

        function getGradeColor(gpa) {
    if (gpa >= 3.7) return '#00bfa5, #0077be';    // A, A+
    if (gpa >= 3.0) return '#0077be, #1e3a5f';    // B, B+
    if (gpa >= 2.0) return '#2c5f7c, #1e3a5f';    // C, C+
    if (gpa >= 1.0) return '#004d7a, #0c1821';    // D, D+
    return '#37474f, #263238';                      // F
}


        // Subject Management (giữ nguyên tất cả logic)
        function addSubject() {
            const name = document.getElementById('subjectName').value.trim();
            const credits = parseInt(document.getElementById('credits').value);
            const attendance = parseFloat(document.getElementById('attendance').value);
            const homework = parseFloat(document.getElementById('homework').value);
            const midterm = parseFloat(document.getElementById('midterm').value);
            const final = parseFloat(document.getElementById('final').value);

            if (!name || !credits || isNaN(attendance) || isNaN(homework) || isNaN(midterm) || isNaN(final)) {
                alert('Vui lòng nhập đầy đủ thông tin!');
                return;
            }

            if (attendance < 0 || attendance > 10 || homework < 0 || homework > 10 || 
                midterm < 0 || midterm > 10 || final < 0 || final > 10) {
                alert('Điểm số phải trong khoảng 0-10!');
                return;
            }

            const totalScore = calculateSubjectScore(attendance, homework, midterm, final);
            const gpa4 = convertTo4Scale(totalScore);

            const subject = {
                id: Date.now(),
                name,
                credits,
                attendance,
                homework,
                midterm,
                final,
                totalScore: totalScore.toFixed(2),
                gpa4: gpa4.toFixed(2)
            };

                        studentData.semesters[studentData.currentSemester].push(subject);
            saveData();
            updateDisplay();
            clearForm();
            generateAISuggestions();
        }

        function clearForm() {
            document.getElementById('subjectName').value = '';
            document.getElementById('credits').value = '';
            document.getElementById('attendance').value = '';
            document.getElementById('homework').value = '';
            document.getElementById('midterm').value = '';
            document.getElementById('final').value = '';
            document.getElementById('averageDisplay').textContent = 'Điểm TB: --';
            document.getElementById('averageDisplay').style.background = 'linear-gradient(45deg, #00bfa5, #0077be)';
        }

        function deleteSubject(semesterNum, subjectId) {
            if (confirm('Bạn có chắc muốn xóa môn học này?')) {
                studentData.semesters[semesterNum] = studentData.semesters[semesterNum].filter(s => s.id !== subjectId);
                saveData();
                updateDisplay();
                generateAISuggestions();
            }
        }

        // Display Functions (giữ nguyên tất cả)
        function updateDisplay() {
            updateSubjectsList();
            updateStatistics();
            updateYearOverview();
            updateAlerts();
        }

        function updateSubjectsList() {
            const container = document.getElementById('subjectsList');
            const subjects = studentData.semesters[studentData.currentSemester];

            if (subjects.length === 0) {
                container.innerHTML = `
                    <p style="text-align: center; color: #b0d4db; padding: 20px;">
                        Chưa có môn học nào trong học kỳ ${studentData.currentSemester}. Hãy thêm môn học đầu tiên!
                    </p>
                `;
                return;
            }

            container.innerHTML = subjects.map(subject => `
                <div class="subject-item">
                    <div>
                        <strong style="color: #00bfa5;">${subject.name}</strong>
                        <div style="font-size: 12px; color: #b0d4db; margin-top: 5px;">
                            ${subject.credits} tín chỉ
                        </div>
                    </div>
                    <div class="subject-scores">
                        <div class="score-item">CC: ${subject.attendance}</div>
                        <div class="score-item">BT: ${subject.homework}</div>
                        <div class="score-item">GK: ${subject.midterm}</div>
                        <div class="score-item">CK: ${subject.final}</div>
                    </div>
                    <div style="text-align: center;">
                        <strong style="color: #00bfa5;">${subject.totalScore}</strong>
                    </div>
                    <div style="text-align: center;">
                        <strong style="color: #0077be;">${subject.gpa4}</strong>
                    </div>
                    <div class="grade-level ${getGradeLevel(parseFloat(subject.gpa4)).class}">
                        ${getGradeLevel(parseFloat(subject.gpa4)).text}
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-danger" onclick="deleteSubject(${studentData.currentSemester}, ${subject.id})" 
                                style="padding: 5px 10px; font-size: 12px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateStatistics() {
            // Current semester stats
            const currentSubjects = studentData.semesters[studentData.currentSemester];
            let currentGPA = 0;
            let currentCredits = 0;

            if (currentSubjects.length > 0) {
                let totalPoints = 0;
                currentSubjects.forEach(subject => {
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    currentCredits += subject.credits;
                });
                currentGPA = currentCredits > 0 ? totalPoints / currentCredits : 0;
            }

            // Cumulative stats
            let totalPoints = 0;
            let totalCredits = 0;
            let totalSubjects = 0;

            Object.values(studentData.semesters).forEach(semester => {
                semester.forEach(subject => {
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    totalCredits += subject.credits;
                    totalSubjects++;
                });
            });

            const cumulativeGPA = totalCredits > 0 ? totalPoints / totalCredits : 0;

            // Update display
            document.getElementById('currentGPA').textContent = currentGPA.toFixed(2);
            document.getElementById('cumulativeGPA').textContent = cumulativeGPA.toFixed(2);
            document.getElementById('totalCredits').textContent = totalCredits;
            document.getElementById('totalSubjects').textContent = totalSubjects;

            // Update grades
            const currentGrade = getGradeLevel(currentGPA);
            const cumulativeGrade = getGradeLevel(cumulativeGPA);
            
            document.getElementById('currentGrade').textContent = currentGrade.text;
            document.getElementById('currentGrade').className = `grade-level ${currentGrade.class}`;
            
            document.getElementById('cumulativeGrade').textContent = cumulativeGrade.text;
            document.getElementById('cumulativeGrade').className = `grade-level ${cumulativeGrade.class}`;

            // Update progress bar
            const progressPercent = Math.min((cumulativeGPA / 4.0) * 100, 100);
            document.getElementById('gpaProgress').style.width = progressPercent + '%';

            // Update detailed stats
            updateDetailedStats();
        }

        function updateDetailedStats() {
            let allSubjects = [];
            Object.values(studentData.semesters).forEach(semester => {
                allSubjects = allSubjects.concat(semester);
            });

            if (allSubjects.length === 0) {
                document.getElementById('averageScore').textContent = '0.00';
                document.getElementById('highestSubject').textContent = '--';
                document.getElementById('lowestSubject').textContent = '--';
                return;
            }

            const totalScore = allSubjects.reduce((sum, subject) => sum + parseFloat(subject.totalScore), 0);
            const averageScore = totalScore / allSubjects.length;

            const highest = allSubjects.reduce((max, subject) => 
                parseFloat(subject.totalScore) > parseFloat(max.totalScore) ? subject : max
            );

            const lowest = allSubjects.reduce((min, subject) => 
                parseFloat(subject.totalScore) < parseFloat(min.totalScore) ? subject : min
            );

            document.getElementById('averageScore').textContent = averageScore.toFixed(2);
            document.getElementById('highestSubject').textContent = `${highest.name} (${highest.totalScore})`;
            document.getElementById('lowestSubject').textContent = `${lowest.name} (${lowest.totalScore})`;
        }

        function updateYearOverview() {
            for (let year = 1; year <= 4; year++) {
                const semester1 = (year - 1) * 2 + 1;
                const semester2 = (year - 1) * 2 + 2;
                
                const subjects1 = studentData.semesters[semester1] || [];
                const subjects2 = studentData.semesters[semester2] || [];
                
                let totalPoints = 0;
                let totalCredits = 0;
                
                [...subjects1, ...subjects2].forEach(subject => {
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    totalCredits += subject.credits;
                });
                
                const yearGPA = totalCredits > 0 ? totalPoints / totalCredits : 0;
                document.getElementById(`year${year}GPA`).textContent = yearGPA > 0 ? yearGPA.toFixed(2) : '--';
            }
        }

        function updateAlerts() {
            const cumulativeGPA = parseFloat(document.getElementById('cumulativeGPA').textContent);
            const scholarshipInfo = document.getElementById('scholarshipInfo');
            const warningCard = document.getElementById('warningCard');

            // Scholarship alerts
            if (cumulativeGPA >= 3.6) {
                scholarshipInfo.style.display = 'block';
                document.getElementById('scholarshipText').textContent = 
                    'Chúc mừng! Bạn đủ điều kiện nhận học bổng xuất sắc với GPA >= 3.6';
            } else if (cumulativeGPA >= 3.2) {
                scholarshipInfo.style.display = 'block';
                document.getElementById('scholarshipText').textContent = 
                    'Chúc mừng! Bạn đủ điều kiện nhận học bổng khuyến khích với GPA >= 3.2';
            } else {
                scholarshipInfo.style.display = 'none';
            }

            // Warning alerts
            if (cumulativeGPA < 2.0 && cumulativeGPA > 0) {
                warningCard.style.display = 'block';
                document.getElementById('warningText').textContent = 
                    'GPA của bạn dưới 2.0. Cần cải thiện để tránh cảnh báo học vụ!';
            } else if (cumulativeGPA < 1.5 && cumulativeGPA > 0) {
                warningCard.style.display = 'block';
                document.getElementById('warningText').textContent = 
                    'GPA rất thấp! Nguy cơ bị đình chỉ học tập. Hãy liên hệ cố vấn học tập!';
            } else {
                warningCard.style.display = 'none';
            }
        }

        // Semester Management (giữ nguyên)
        function switchSemester(semesterNum) {
            studentData.currentSemester = semesterNum;
            
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-semester="${semesterNum}"]`).classList.add('active');
            
            // Update title
            document.getElementById('currentSemesterTitle').textContent = `Học kỳ ${semesterNum}`;
            
            updateDisplay();
            clearForm();
        }

        // Data Import/Export (giữ nguyên)
        function exportData() {
            const dataStr = JSON.stringify(studentData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `hub-gpa-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (importedData.semesters) {
                        if (confirm('Bạn có muốn ghi đè dữ liệu hiện tại?')) {
                            studentData = importedData;
                            saveData();
                            updateDisplay();
                            alert('Đã nhập dữ liệu thành công!');
                        }
                    } else {
                        alert('File không đúng định dạng!');
                    }
                } catch (error) {
                    alert('Lỗi khi đọc file!');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function resetAllData() {
            if (confirm('Bạn có chắc muốn xóa tất cả dữ liệu? Hành động này không thể hoàn tác!')) {
                if (confirm('Xác nhận lần cuối: Xóa tất cả dữ liệu?')) {
                    studentData = {
                        semesters: {
                            1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [], 8: []
                        },
                        currentSemester: 1
                    };
                    localStorage.removeItem('hubGPAData');
                    switchSemester(1);
                    clearForm();
                    alert('Đã xóa tất cả dữ liệu!');
                }
            }
        }

        // AI Features (giữ nguyên tất cả)
        function generateAISuggestions() {
            const cumulativeGPA = parseFloat(document.getElementById('cumulativeGPA').textContent);
            const totalSubjects = parseInt(document.getElementById('totalSubjects').textContent);
            const container = document.getElementById('suggestionsContent');

            let suggestions = [];

            if (totalSubjects === 0) {
                suggestions.push({
                    icon: 'fas fa-info-circle',
                    title: 'Bắt đầu nhập điểm',
                    content: 'Hãy thêm các môn học và điểm số để AI có thể phân tích và đưa ra gợi ý phù hợp.'
                });
            } else {
                if (cumulativeGPA >= 3.6) {
                    suggestions.push({
                        icon: 'fas fa-trophy',
                        title: 'Xuất sắc!',
                        content: 'GPA của bạn rất tuyệt vời! Hãy duy trì phong độ này và tìm hiểu về các học bổng cao cấp.'
                    });
                } else if (cumulativeGPA >= 3.2) {
                    suggestions.push({
                        icon: 'fas fa-star',
                        title: 'Rất tốt!',
                        content: 'Bạn đang có kết quả tốt. Cố gắng thêm một chút để đạt mức xuất sắc (GPA ≥ 3.6).'
                    });
                } else if (cumulativeGPA >= 2.5) {
                    suggestions.push({
                        icon: 'fas fa-chart-line',
                        title: 'Cần cải thiện',
                        content: 'Hãy tập trung vào các môn yếu và cải thiện phương pháp học tập để nâng cao GPA.'
                    });
                } else if (cumulativeGPA >= 2.0) {
                    suggestions.push({
                        icon: 'fas fa-exclamation-triangle',
                        title: 'Cảnh báo',
                        content: 'GPA của bạn ở mức nguy hiểm. Cần có kế hoạch học tập cụ thể và tìm sự hỗ trợ từ giảng viên.'
                    });
                } else {
                    suggestions.push({
                        icon: 'fas fa-sos',
                        title: 'Khẩn cấp',
                        content: 'GPA rất thấp! Hãy liên hệ ngay với cố vấn học tập và xem xét khả năng học lại các môn.'
                    });
                }

                // Additional suggestions based on data analysis
                const allSubjects = [];
                Object.values(studentData.semesters).forEach(semester => {
                    allSubjects.push(...semester);
                });

                if (allSubjects.length > 0) {
                    const avgAttendance = allSubjects.reduce((sum, s) => sum + s.attendance, 0) / allSubjects.length;
                    const avgHomework = allSubjects.reduce((sum, s) => sum + s.homework, 0) / allSubjects.length;
                    const avgMidterm = allSubjects.reduce((sum, s) => sum + s.midterm, 0) / allSubjects.length;
                    const avgFinal = allSubjects.reduce((sum, s) => sum + s.final, 0) / allSubjects.length;

                    if (avgAttendance < 8) {
                        suggestions.push({
                            icon: 'fas fa-calendar-check',
                            title: 'Cải thiện chuyên cần',
                            content: 'Điểm chuyên cần của bạn có thể tốt hơn. Hãy tham gia lớp đầy đủ và tích cực.'
                        });
                    }

                    if (avgHomework < avgFinal - 1) {
                        suggestions.push({
                            icon: 'fas fa-tasks',
                            title: 'Tập trung vào bài tập',
                            content: 'Điểm bài tập thấp hơn điểm thi. Hãy làm bài tập nghiêm túc để củng cố kiến thức.'
                        });
                    }

                    if (avgFinal < avgMidterm) {
                        suggestions.push({
                            icon: 'fas fa-brain',
                            title: 'Chuẩn bị thi cuối kỳ',
                            content: 'Điểm cuối kỳ thấp hơn giữa kỳ. Cần cải thiện phương pháp ôn tập và quản lý thời gian.'
                        });
                    }
                }
            }

            container.innerHTML = suggestions.map(suggestion => `
                <div class="suggestion-item">
                    <i class="${suggestion.icon}" style="margin-right: 10px; color: #00bfa5;"></i>
                    <strong style="color: #00bfa5;">${suggestion.title}:</strong> ${suggestion.content}
                </div>
            `).join('');
        }

        function showAIChat() {
            document.getElementById('aiChatModal').style.display = 'block';
        }

        function closeAIChat() {
            document.getElementById('aiChatModal').style.display = 'none';
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            const chatMessages = document.getElementById('chatMessages');
            
            // Add user message
            chatMessages.innerHTML += `
                <div style="text-align: right; margin: 10px 0;">
                    <div style="background: linear-gradient(45deg, #00bfa5, #0077be); color: white; padding: 10px 15px; border-radius: 15px; display: inline-block; max-width: 70%;">
                        ${message}
                    </div>
                </div>
            `;

            // Generate AI response
            setTimeout(() => {
                const response = generateAIResponse(message);
                chatMessages.innerHTML += `
                    <div style="text-align: left; margin: 10px 0;">
                        <div style="background: rgba(30, 58, 95, 0.6); color: #e8f4f8; padding: 10px 15px; border-radius: 15px; display: inline-block; max-width: 70%; border: 1px solid rgba(0, 191, 165, 0.3);">
                            <i class="fas fa-robot" style="margin-right: 8px; color: #00bfa5;"></i>
                            ${response}
                        </div>
                    </div>
                `;
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);

            input.value = '';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function generateAIResponse(message) {
            const msg = message.toLowerCase();
            const cumulativeGPA = parseFloat(document.getElementById('cumulativeGPA').textContent);
            const totalSubjects = parseInt(document.getElementById('totalSubjects').textContent);

            if (msg.includes('gpa') || msg.includes('điểm')) {
                if (cumulativeGPA === 0) {
                    return 'Bạn chưa có dữ liệu điểm nào. Hãy bắt đầu nhập điểm các môn học để tôi có thể phân tích cho bạn.';
                }
                return `GPA tích lũy hiện tại của bạn là ${cumulativeGPA.toFixed(2)}. ${getGPAAdvice(cumulativeGPA)}`;
            }

            if (msg.includes('học bổng') || msg.includes('scholarship')) {
                if (cumulativeGPA >= 3.6) {
                    return 'Tuyệt vời! Bạn đủ điều kiện cho học bổng xuất sắc. Hãy tìm hiểu thêm về các chương trình học bổng tại trường.';
                } else if (cumulativeGPA >= 3.2) {
                    return 'Bạn đủ điều kiện cho học bổng khuyến khích. Cố gắng thêm để đạt mức xuất sắc nhé!';
                } else {
                    return `Để đủ điều kiện học bổng, bạn cần GPA tối thiểu 3.2. Hiện tại bạn cần cải thiện thêm ${(3.2 - cumulativeGPA).toFixed(2)} điểm.`;
                }
            }

            if (msg.includes('cải thiện') || msg.includes('tăng') || msg.includes('improve')) {
                return getImprovementAdvice();
            }

            if (msg.includes('dự đoán') || msg.includes('predict')) {
                return 'Tôi có thể giúp bạn dự đoán điểm cần thiết để đạt mục tiêu. Hãy sử dụng nút "Dự đoán điểm" trong phần thống kê.';
            }

            if (msg.includes('xin chào') || msg.includes('hello') || msg.includes('hi')) {
                return 'Xin chào! Tôi là AI Assistant của HUB GPA Calculator. Tôi có thể giúp bạn phân tích điểm số, tư vấn cách cải thiện GPA, và thông tin về học bổng. Bạn cần hỗ trợ gì?';
            }

            // Default response
            return 'Tôi hiểu bạn đang hỏi về học tập. Tôi có thể giúp bạn với: phân tích GPA, tư vấn cải thiện điểm số, thông tin học bổng, và dự đoán điểm cần thiết. Bạn muốn tìm hiểu về vấn đề nào?';
        }

        function getGPAAdvice(gpa) {
            if (gpa >= 3.6) return 'Xuất sắc! Hãy duy trì phong độ này.';
            if (gpa >= 3.2) return 'Tốt! Cố gắng thêm để đạt mức xuất sắc.';
            if (gpa >= 2.5) return 'Khá ổn, nhưng cần cải thiện để đạt kết quả tốt hơn.';
            if (gpa >= 2.0) return 'Cần nỗ lực nhiều hơn để tránh cảnh báo học vụ.';
            return 'Tình hình nghiêm trọng, cần có kế hoạch học tập cụ thể ngay.';
        }

        function getImprovementAdvice() {
            const allSubjects = [];
            Object.values(studentData.semesters).forEach(semester => {
                allSubjects.push(...semester);
            });

            if (allSubjects.length === 0) {
                return 'Hãy bắt đầu nhập điểm để tôi có thể đưa ra lời khuyên cụ thể.';
            }

            const avgComponents = {
                attendance: allSubjects.reduce((sum, s) => sum + s.attendance, 0) / allSubjects.length,
                homework: allSubjects.reduce((sum, s) => sum + s.homework, 0) / allSubjects.length,
                midterm: allSubjects.reduce((sum, s) => sum + s.midterm, 0) / allSubjects.length,
                final: allSubjects.reduce((sum, s) => sum + s.final, 0) / allSubjects.length
            };

            let advice = 'Dựa trên phân tích điểm số của bạn, tôi khuyên: ';
            const suggestions = [];

            if (avgComponents.attendance < 8) suggestions.push('Cải thiện chuyên cần (tham gia lớp đầy đủ)');
            if (avgComponents.homework < 7) suggestions.push('Làm bài tập nghiêm túc hơn');
            if (avgComponents.midterm < 7) suggestions.push('Ôn tập thường xuyên cho kiểm tra giữa kỳ');
            if (avgComponents.final < 7) suggestions.push('Chuẩn bị kỹ lưỡng cho thi cuối kỳ');

            if (suggestions.length === 0) {
                return 'Điểm số của bạn khá đều. Hãy duy trì phong độ và tìm cách nâng cao thêm ở tất cả các thành phần.';
            }

            return advice + suggestions.join(', ') + '.';
        }

        // Prediction Feature (giữ nguyên)
        function predictRequiredScore() {
            const targetGPA = prompt('Nhập GPA mục tiêu (0.0 - 4.0):');
            if (!targetGPA || isNaN(targetGPA) || targetGPA < 0 || targetGPA > 4) {
                alert('Vui lòng nhập GPA hợp lệ (0.0 - 4.0)!');
                return;
            }

            const target = parseFloat(targetGPA);
            const currentGPA = parseFloat(document.getElementById('cumulativeGPA').textContent);
            const totalCredits = parseInt(document.getElementById('totalCredits').textContent);

            if (totalCredits === 0) {
                alert('Chưa có dữ liệu để dự đoán!');
                return;
            }

            const creditsNeeded = prompt('Nhập số tín chỉ dự kiến học thêm:');
            if (!creditsNeeded || isNaN(creditsNeeded) || creditsNeeded <= 0) {
                alert('Vui lòng nhập số tín chỉ hợp lệ!');
                return;
            }

            const newCredits = parseInt(creditsNeeded);
            const currentPoints = currentGPA * totalCredits;
            const targetPoints = target * (totalCredits + newCredits);
            const requiredPoints = targetPoints - currentPoints;
            const requiredGPA = requiredPoints / newCredits;

            let message = `Để đạt GPA ${target} với ${newCredits} tín chỉ mới:\n\n`;
            
            if (requiredGPA > 4.0) {
                message += `❌ Không thể đạt được! GPA cần thiết: ${requiredGPA.toFixed(2)} (vượt quá 4.0)\n`;
                message += `💡 GPA tối đa có thể đạt: ${((currentPoints + 4.0 * newCredits) / (totalCredits + newCredits)).toFixed(2)}`;
            } else if (requiredGPA < 0) {
                message += `✅ Mục tiêu dễ dàng đạt được! Bạn có thể có GPA thấp nhất là ${Math.max(0, requiredGPA).toFixed(2)}`;
            } else {
                message += `📊 GPA cần thiết cho ${newCredits} tín chỉ mới: ${requiredGPA.toFixed(2)}\n`;
                message += `📈 Điểm trung bình cần đạt: ${(requiredGPA * 2.5 + 2.5).toFixed(2)}/10`;
                
                if (requiredGPA >= 3.5) {
                    message += `\n⚠️ Mục tiêu khó, cần nỗ lực rất nhiều!`;
                } else if (requiredGPA >= 3.0) {
                    message += `\n💪 Mục tiêu khả thi với nỗ lực!`;
                } else {
                    message += `\n😊 Mục tiêu dễ đạt!`;
                }
            }

            alert(message);
        }

        // Charts Functions (giữ nguyên tất cả)
        function showChartsModal() {
            document.getElementById('chartsModal').style.display = 'block';
            updateChartsData();
            setTimeout(() => {
                renderCharts();
            }, 100);
        }

        function closeChartsModal() {
            document.getElementById('chartsModal').style.display = 'none';
        }

        function switchChartTab(tabName) {
            // Update tabs
            document.querySelectorAll('.chart-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update sections
            document.querySelectorAll('.chart-section').forEach(section => section.classList.remove('active'));
            document.getElementById(tabName + 'Section').classList.add('active');

            // Re-render charts for the active section
            setTimeout(() => {
                renderChartsForSection(tabName);
            }, 100);
        }

        function updateChartsData() {
            let totalSubjects = 0;
                        let totalCredits = 0;
            let totalPoints = 0;
            let completedSemesters = 0;

            Object.values(studentData.semesters).forEach(semester => {
                if (semester.length > 0) {
                    completedSemesters++;
                    semester.forEach(subject => {
                        totalSubjects++;
                        totalCredits += subject.credits;
                        totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    });
                }
            });

            const avgGPA = totalCredits > 0 ? totalPoints / totalCredits : 0;

            document.getElementById('totalSubjectsChart').textContent = totalSubjects;
            document.getElementById('avgGPAChart').textContent = avgGPA.toFixed(2);
            document.getElementById('totalCreditsChart').textContent = totalCredits;
            document.getElementById('completedSemestersChart').textContent = completedSemesters;
        }

        function renderCharts() {
            renderChartsForSection('overview');
        }

        function renderChartsForSection(section) {
            switch(section) {
                case 'overview':
                    renderGPAChart();
                    renderYearlyChart();
                    break;
                case 'distribution':
                    renderSubjectChart();
                    renderGradeChart();
                    break;
                case 'comparison':
                    renderComponentChart();
                    renderCreditsChart();
                    break;
                case 'analysis':
                    renderTrendChart();
                    renderPredictionChart();
                    break;
            }
        }

        function renderGPAChart() {
            const ctx = document.getElementById('gpaChart');
            if (!ctx) return;

            const semesterGPAs = [];
            const labels = [];

            for (let i = 1; i <= 8; i++) {
                const subjects = studentData.semesters[i];
                if (subjects.length > 0) {
                    let totalPoints = 0;
                    let totalCredits = 0;
                    subjects.forEach(subject => {
                        totalPoints += parseFloat(subject.gpa4) * subject.credits;
                        totalCredits += subject.credits;
                    });
                    const gpa = totalCredits > 0 ? totalPoints / totalCredits : 0;
                    semesterGPAs.push(gpa);
                    labels.push(`HK ${i}`);
                } else {
                    semesterGPAs.push(null);
                    labels.push(`HK ${i}`);
                }
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'GPA theo học kỳ',
                        data: semesterGPAs,
                        borderColor: '#00bfa5',
                        backgroundColor: 'rgba(0, 191, 165, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#00bfa5',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e8f4f8'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        }
                    }
                }
            });
        }

        function renderYearlyChart() {
            const ctx = document.getElementById('yearlyChart');
            if (!ctx) return;

            const yearlyGPAs = [];
            const yearLabels = ['Năm 1', 'Năm 2', 'Năm 3', 'Năm 4'];

            for (let year = 1; year <= 4; year++) {
                const semester1 = (year - 1) * 2 + 1;
                const semester2 = (year - 1) * 2 + 2;
                
                const subjects1 = studentData.semesters[semester1] || [];
                const subjects2 = studentData.semesters[semester2] || [];
                
                let totalPoints = 0;
                let totalCredits = 0;
                
                [...subjects1, ...subjects2].forEach(subject => {
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    totalCredits += subject.credits;
                });
                
                const yearGPA = totalCredits > 0 ? totalPoints / totalCredits : 0;
                yearlyGPAs.push(yearGPA);
            }

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: yearLabels,
                    datasets: [{
                        label: 'GPA theo năm',
                        data: yearlyGPAs,
                        backgroundColor: [
                            'rgba(0, 191, 165, 0.8)',
                            'rgba(0, 119, 190, 0.8)',
                            'rgba(30, 58, 95, 0.8)',
                            'rgba(44, 95, 124, 0.8)'
                        ],
                        borderColor: [
                            '#00bfa5',
                            '#0077be',
                            '#1e3a5f',
                            '#2c5f7c'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e8f4f8'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        }
                    }
                }
            });
        }

        function renderSubjectChart() {
            const ctx = document.getElementById('subjectChart');
            if (!ctx) return;

            const allSubjects = [];
            Object.values(studentData.semesters).forEach(semester => {
                allSubjects.push(...semester);
            });

            if (allSubjects.length === 0) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                return;
            }

            const subjectNames = allSubjects.map(s => s.name.length > 15 ? s.name.substring(0, 15) + '...' : s.name);
            const subjectScores = allSubjects.map(s => parseFloat(s.gpa4));

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: subjectNames,
                    datasets: [{
                        label: 'GPA các môn học',
                        data: subjectScores,
                        backgroundColor: subjectScores.map(score => {
                            if (score >= 3.6) return 'rgba(0, 191, 165, 0.8)';
                            if (score >= 3.2) return 'rgba(0, 119, 190, 0.8)';
                            if (score >= 2.5) return 'rgba(30, 58, 95, 0.8)';
                            if (score >= 2.0) return 'rgba(44, 95, 124, 0.8)';
                            return 'rgba(55, 71, 79, 0.8)';
                        }),
                        borderColor: '#00bfa5',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e8f4f8'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e8f4f8',
                                maxRotation: 45
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        }
                    }
                }
            });
        }

        function renderGradeChart() {
            const ctx = document.getElementById('gradeChart');
            if (!ctx) return;

            const allSubjects = [];
            Object.values(studentData.semesters).forEach(semester => {
                allSubjects.push(...semester);
            });

            if (allSubjects.length === 0) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                return;
            }

            const gradeCounts = {
                'Xuất sắc': 0,
                'Giỏi': 0,
                'Khá': 0,
                'Trung bình': 0,
                'Yếu/Kém': 0
            };

            allSubjects.forEach(subject => {
                const gpa = parseFloat(subject.gpa4);
                if (gpa >= 3.6) gradeCounts['Xuất sắc']++;
                else if (gpa >= 3.2) gradeCounts['Giỏi']++;
                else if (gpa >= 2.5) gradeCounts['Khá']++;
                else if (gpa >= 2.0) gradeCounts['Trung bình']++;
                else gradeCounts['Yếu/Kém']++;
            });

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(gradeCounts),
                    datasets: [{
                        data: Object.values(gradeCounts),
                        backgroundColor: [
                            '#00bfa5',
                            '#0077be',
                            '#1e3a5f',
                            '#2c5f7c',
                            '#37474f'
                        ],
                        borderColor: '#e8f4f8',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e8f4f8',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }

        function renderComponentChart() {
            const ctx = document.getElementById('componentChart');
            if (!ctx) return;

            const allSubjects = [];
            Object.values(studentData.semesters).forEach(semester => {
                allSubjects.push(...semester);
            });

            if (allSubjects.length === 0) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                return;
            }

            const avgComponents = {
                attendance: allSubjects.reduce((sum, s) => sum + s.attendance, 0) / allSubjects.length,
                homework: allSubjects.reduce((sum, s) => sum + s.homework, 0) / allSubjects.length,
                midterm: allSubjects.reduce((sum, s) => sum + s.midterm, 0) / allSubjects.length,
                final: allSubjects.reduce((sum, s) => sum + s.final, 0) / allSubjects.length
            };

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Chuyên cần', 'Bài tập', 'Giữa kỳ', 'Cuối kỳ'],
                    datasets: [{
                        label: 'Điểm trung bình',
                        data: [avgComponents.attendance, avgComponents.homework, avgComponents.midterm, avgComponents.final],
                        backgroundColor: 'rgba(0, 191, 165, 0.2)',
                        borderColor: '#00bfa5',
                        borderWidth: 2,
                        pointBackgroundColor: '#00bfa5',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e8f4f8'
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            },
                            pointLabels: {
                                color: '#e8f4f8'
                            }
                        }
                    }
                }
            });
        }

        function renderCreditsChart() {
            const ctx = document.getElementById('creditsChart');
            if (!ctx) return;

            const semesterCredits = [];
            const labels = [];

            for (let i = 1; i <= 8; i++) {
                const subjects = studentData.semesters[i];
                const credits = subjects.reduce((sum, subject) => sum + subject.credits, 0);
                semesterCredits.push(credits);
                labels.push(`HK ${i}`);
            }

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Tín chỉ theo học kỳ',
                        data: semesterCredits,
                        backgroundColor: 'rgba(0, 119, 190, 0.8)',
                        borderColor: '#0077be',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e8f4f8'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        }
                    }
                }
            });
        }

        function renderTrendChart() {
            const ctx = document.getElementById('trendChart');
            if (!ctx) return;

            const cumulativeGPAs = [];
            const labels = [];
            let totalPoints = 0;
            let totalCredits = 0;

            for (let i = 1; i <= 8; i++) {
                const subjects = studentData.semesters[i];
                subjects.forEach(subject => {
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    totalCredits += subject.credits;
                });
                
                if (totalCredits > 0) {
                    cumulativeGPAs.push(totalPoints / totalCredits);
                    labels.push(`Sau HK ${i}`);
                }
            }

            if (cumulativeGPAs.length === 0) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                return;
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'GPA tích lũy',
                        data: cumulativeGPAs,
                        borderColor: '#00bfa5',
                        backgroundColor: 'rgba(0, 191, 165, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#00bfa5',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e8f4f8'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        }
                    }
                }
            });
        }

        function renderPredictionChart() {
            const ctx = document.getElementById('predictionChart');
            if (!ctx) return;

            // Simple prediction based on current trend
            const currentGPA = parseFloat(document.getElementById('cumulativeGPA').textContent);
            const totalCredits = parseInt(document.getElementById('totalCredits').textContent);

            if (currentGPA === 0 || totalCredits === 0) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                return;
            }

            const predictions = [];
            const labels = [];
            
            // Predict for next 4 semesters with different scenarios
            for (let i = 1; i <= 4; i++) {
                labels.push(`+${i} HK`);
            }

            // Optimistic scenario (3.5 GPA for new semesters)
            const optimisticPredictions = [];
            let currentPoints = currentGPA * totalCredits;
            let currentTotalCredits = totalCredits;
            
            for (let i = 1; i <= 4; i++) {
                const newCredits = 15; // Assume 15 credits per semester
                currentPoints += 3.5 * newCredits;
                currentTotalCredits += newCredits;
                optimisticPredictions.push(currentPoints / currentTotalCredits);
            }

            // Realistic scenario (current GPA maintained)
            const realisticPredictions = [];
            currentPoints = currentGPA * totalCredits;
            currentTotalCredits = totalCredits;
            
            for (let i = 1; i <= 4; i++) {
                const newCredits = 15;
                currentPoints += currentGPA * newCredits;
                currentTotalCredits += newCredits;
                realisticPredictions.push(currentPoints / currentTotalCredits);
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Kịch bản tích cực',
                            data: optimisticPredictions,
                            borderColor: '#00bfa5',
                            backgroundColor: 'rgba(0, 191, 165, 0.1)',
                            borderWidth: 2,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'Kịch bản thực tế',
                            data: realisticPredictions,
                            borderColor: '#0077be',
                            backgroundColor: 'rgba(0, 119, 190, 0.1)',
                            borderWidth: 2,
                            borderDash: [10, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e8f4f8'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e8f4f8'
                            },
                            grid: {
                                color: 'rgba(0, 191, 165, 0.2)'
                            }
                        }
                    }
                }
            });
        }

        // Help Modal
        function showHelpModal() {
            const helpModal = document.createElement('div');
            helpModal.className = 'modal';
            helpModal.style.display = 'block';
            helpModal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2 style="color: #00bfa5; font-size: 2.5em;">
                            <i class="fas fa-question-circle"></i> Hướng dẫn sử dụng
                        </h2>
                        <p style="color: #b0d4db;">Hướng dẫn chi tiết sử dụng HUB GPA Calculator</p>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #00bfa5; margin-bottom: 15px;"><i class="fas fa-plus"></i> Thêm môn học</h3>
                        <p style="color: #e8f4f8; line-height: 1.6;">
                            1. Chọn học kỳ từ tabs ở trên<br>
                            2. Nhập tên môn học và số tín chỉ<br>
                            3. Nhập điểm các thành phần: Chuyên cần (10%), Bài tập (20%), Giữa kỳ (20%), Cuối kỳ (50%)<br>
                            4. Hệ thống sẽ tự động tính điểm trung bình và GPA
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #00bfa5; margin-bottom: 15px;"><i class="fas fa-chart-bar"></i> Xem thống kê</h3>
                        <p style="color: #e8f4f8; line-height: 1.6;">
                            • <strong>GPA Học kỳ:</strong> Điểm trung bình của học kỳ hiện tại<br>
                            • <strong>GPA Tích lũy:</strong> Điểm trung bình của toàn bộ khóa học<br>
                            • <strong>Biểu đồ:</strong> Trực quan hóa kết quả học tập qua các học kỳ<br>
                            • <strong>AI Assistant:</strong> Phân tích và đưa ra gợi ý cải thiện
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #00bfa5; margin-bottom: 15px;"><i class="fas fa-award"></i> Thang điểm và xếp loại</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div style="background: rgba(0, 191, 165, 0.1); padding: 15px; border-radius: 10px;">
                                <strong>Thang điểm 4:</strong><br>
                                • 9.0-10: 4.0 (Xuất sắc)<br>
                                • 8.5-8.9: 3.7<br>
                                • 8.0-8.4: 3.5<br>
                                • 7.5-7.9: 3.2 (Giỏi)<br>
                                • 7.0-7.4: 3.0<br>
                                • 6.5-6.9: 2.7<br>
                                • 6.0-6.4: 2.5 (Khá)
                            </div>
                            <div style="background: rgba(0, 119, 190, 0.1); padding: 15px; border-radius: 10px;">
                                <strong>Học bổng:</strong><br>
                                • GPA ≥ 3.6: Học bổng xuất sắc<br>
                                • GPA ≥ 3.2: Học bổng khuyến khích<br><br>
                                <strong>Cảnh báo:</strong><br>
                                • GPA < 2.0: Cảnh báo học vụ<br>
                                • GPA < 1.5: Nguy cơ đình chỉ
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #00bfa5; margin-bottom: 15px;"><i class="fas fa-tools"></i> Tính năng nâng cao</h3>
                        <p style="color: #e8f4f8; line-height: 1.6;">
                            • <strong>Dự đoán điểm:</strong> Tính toán điểm cần thiết để đạt GPA mục tiêu<br>
                            • <strong>Xuất/Nhập dữ liệu:</strong> Sao lưu và khôi phục dữ liệu<br>
                            • <strong>AI Chat:</strong> Tư vấn học tập thông minh<br>
                            • <strong>Ngoại ngữ:</strong> Học từ vựng tiếng Anh học thuật
                        </p>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn btn-primary" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-check"></i> Đã hiểu
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(helpModal);
        }

        // Event Listeners (giữ nguyên)
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateDisplay();
            generateAISuggestions();

            // Semester tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const semester = parseInt(this.dataset.semester);
                    switchSemester(semester);
                });
            });

            // Real-time score calculation
            ['attendance', 'homework', 'midterm', 'final'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateRealTimeScore);
            });

            // Chat input enter key
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                const aiModal = document.getElementById('aiChatModal');
                const chartsModal = document.getElementById('chartsModal');
                
                if (e.target === aiModal) {
                    closeAIChat();
                }
                if (e.target === chartsModal) {
                    closeChartsModal();
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        exportData();
                        break;
                    case 'h':
                        e.preventDefault();
                        showHelpModal();
                        break;
                    case 'c':
                        e.preventDefault();
                        showChartsModal();
                        break;
                }
            }
        });
    </script>
</body>
</html>



