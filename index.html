<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUB GPA Calculator - Tính Điểm GPA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            font-size: 1.5em;
        }

        .card h3 i {
            margin-right: 10px;
            color: #667eea;
        }

        /* Semester Tabs */
        .semester-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab {
            padding: 12px 20px;
            background: #f8f9fa;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
        }

        .tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            margin: 5px;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #2ed573, #1e90ff);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        /* Average Display */
        .average-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.5em;
            font-weight: bold;
        }

        /* Subject List */
        .subjects-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .subject-item {
            display: grid;
            grid-template-columns: 2fr 3fr 1fr 1fr 1fr 1fr;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .subject-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .subject-scores {
            display: flex;
            gap: 10px;
        }

        .score-item {
            background: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }

        /* Grade Levels */
        .grade-level {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }

        .grade-excellent { background: #ff6b6b; color: white; }
        .grade-good { background: #4834d4; color: white; }
        .grade-fair { background: #f39c12; color: white; }
        .grade-average { background: #2ed573; color: white; }
        .grade-poor { background: #95a5a6; color: white; }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        /* GPA Progress */
        .gpa-progress {
            background: #e9ecef;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .gpa-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        /* Year Overview */
        .year-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .year-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .year-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        /* AI Suggestions */
        .suggestions-content {
            max-height: 300px;
            overflow-y: auto;
        }

        .suggestion-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            margin: 50px auto;
            position: relative;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        /* Chat Messages */
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            background: #f8f9fa;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input-container input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 16px;
        }

        /* Charts Modal */
        .charts-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            overflow-y: auto;
        }

        .charts-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 1200px;
            margin: 20px auto;
            position: relative;
            min-height: 80vh;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .chart-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            height: 400px;
        }

        .chart-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-item {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .chart-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
        }

        .chart-tab {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            margin: 0 5px;
        }

        .chart-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .chart-section {
            display: none;
        }

        .chart-section.active {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .subject-item {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .year-overview {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .semester-tabs {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .card {
            animation: fadeIn 0.5s ease-out;
        }

        /* Tooltips */
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
        }

        /* Welcome message */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        kbd {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-graduation-cap"></i> HUB GPA Calculator</h1>
            <p>Hệ thống tính điểm GPA thông minh - Hỗ trợ với AI Assistant</p>
            
            <!-- Action Buttons -->
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="exportData()">
                    <i class="fas fa-download"></i> Xuất dữ liệu
                </button>
                <label class="btn btn-primary" style="cursor: pointer;">
                    <i class="fas fa-upload"></i> Nhập dữ liệu
                    <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                </label>
                <button class="btn btn-primary" onclick="showChartsModal()" style="background: linear-gradient(45deg, #2ed573, #1e90ff);">
                    <i class="fas fa-chart-bar"></i> Xem biểu đồ
                </button>
                <button class="btn btn-danger" onclick="resetAllData()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24);">
                    <i class="fas fa-trash-alt"></i> Xóa tất cả
                </button>
                <button class="btn btn-primary" onclick="showHelpModal()" style="background: linear-gradient(45deg, #4834d4, #686de0);">
                    <i class="fas fa-question-circle"></i> Hướng dẫn
                </button>
            </div>
        </div>

        <!-- Semester Tabs -->
        <div class="semester-tabs">
            <button class="tab active" data-semester="1">HK 1</button>
            <button class="tab" data-semester="2">HK 2</button>
            <button class="tab" data-semester="3">HK 3</button>
            <button class="tab" data-semester="4">HK 4</button>
            <button class="tab" data-semester="5">HK 5</button>
            <button class="tab" data-semester="6">HK 6</button>
            <button class="tab" data-semester="7">HK 7</button>
            <button class="tab" data-semester="8">HK 8</button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Input Form -->
            <div class="card">
                <h3><i class="fas fa-plus-circle"></i> Thêm môn học - <span id="currentSemesterTitle">Học kỳ 1</span></h3>
                
                <div class="form-group">
                    <label for="subjectName">Tên môn học:</label>
                    <input type="text" id="subjectName" placeholder="Nhập tên môn học">
                </div>

                <div class="form-group">
                    <label for="credits">Số tín chỉ:</label>
                    <input type="number" id="credits" min="1" max="10" placeholder="Số tín chỉ">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="attendance">Chuyên cần (10%):</label>
                        <input type="number" id="attendance" min="0" max="10" step="0.1" placeholder="0-10" 
                               data-tooltip="Điểm chuyên cần (0-10), chiếm 10% tổng điểm">
                    </div>
                    <div class="form-group">
                        <label for="homework">Bài tập (20%):</label>
                        <input type="number" id="homework" min="0" max="10" step="0.1" placeholder="0-10"
                               data-tooltip="Điểm bài tập (0-10), chiếm 20% tổng điểm">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="midterm">Giữa kỳ (20%):</label>
                        <input type="number" id="midterm" min="0" max="10" step="0.1" placeholder="0-10"
                               data-tooltip="Điểm giữa kỳ (0-10), chiếm 20% tổng điểm">
                    </div>
                    <div class="form-group">
                        <label for="final">Cuối kỳ (50%):</label>
                        <input type="number" id="final" min="0" max="10" step="0.1" placeholder="0-10"
                               data-tooltip="Điểm cuối kỳ (0-10), chiếm 50% tổng điểm">
                    </div>
                </div>

                <div class="average-display" id="averageDisplay">
                    Điểm TB: --
                </div>

                <button class="btn btn-primary" onclick="addSubject()" style="width: 100%;">
                    <i class="fas fa-plus"></i> Thêm môn học
                </button>
            </div>

            <!-- Subject List -->
            <div class="card">
                <h3><i class="fas fa-list"></i> Danh sách môn học</h3>
                <div class="subjects-list" id="subjectsList">
                    <p style="text-align: center; color: #999; padding: 20px;">
                        Chưa có môn học nào. Hãy thêm môn học đầu tiên!
                    </p>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="currentGPA">0.00</div>
                <div class="stat-label">GPA Học kỳ</div>
                <div class="grade-level" id="currentGrade">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="cumulativeGPA">0.00</div>
                <div class="stat-label">GPA Tích lũy</div>
                <div class="grade-level" id="cumulativeGrade">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCredits">0</div>
                <div class="stat-label">Tổng tín chỉ</div>
                <div class="gpa-progress">
                    <div class="gpa-progress-bar" id="gpaProgress" style="width: 0%"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalSubjects">0</div>
                <div class="stat-label">Tổng môn học</div>
                <button class="btn btn-primary" onclick="predictRequiredScore()" style="margin-top: 10px; font-size: 12px; padding: 8px 12px;">
                    Dự đoán điểm
                </button>
            </div>
        </div>

        <!-- Year Overview -->
        <div class="card">
            <h3><i class="fas fa-calendar-alt"></i> Tổng quan theo năm</h3>
            <div class="year-overview">
                <div class="year-item">
                    <div class="year-number" id="year1GPA">--</div>
                    <div>Năm 1</div>
                </div>
                <div class="year-item">
                    <div class="year-number" id="year2GPA">--</div>
                    <div>Năm 2</div>
                </div>
                <div class="year-item">
                    <div class="year-number" id="year3GPA">--</div>
                    <div>Năm 3</div>
                </div>
                <div class="year-item">
                    <div class="year-number" id="year4GPA">--</div>
                    <div>Năm 4</div>
                </div>
            </div>
        </div>

        <!-- Additional Stats -->
        <div class="card" style="margin-top: 30px;">
            <h3><i class="fas fa-chart-line"></i> Thống kê chi tiết</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <strong>Điểm trung bình:</strong>
                    <span id="averageScore">0.00</span>
                </div>
                <div>
                    <strong>Môn cao nhất:</strong>
                    <span id="highestSubject">--</span>
                </div>
                <div>
                    <strong>Môn thấp nhất:</strong>
                    <span id="lowestSubject">--</span>
                </div>
                <div>
                    <strong>Tổng môn học:</strong>
                    <span id="totalSubjects">0</span>
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 30px;">
            <h3><i class="fas fa-robot"></i> AI Assistant</h3>
            <div class="suggestions-content" id="suggestionsContent">
                <div class="suggestion-item">
                    <i class="fas fa-info-circle" style="margin-right: 10px;"></i>
                    <strong>Bắt đầu nhập điểm:</strong> Hãy thêm các môn học và điểm số để AI có thể phân tích và đưa ra gợi ý phù hợp.
                </div>
            </div>
            <button class="btn btn-primary" onclick="showAIChat()" style="width: 100%; margin-top: 15px;">
                <i class="fas fa-comments"></i> Chat với AI
            </button>
        </div>

        <!-- Alerts -->
        <div class="alert alert-success" id="scholarshipInfo">
            <strong><i class="fas fa-award"></i> Thông báo học bổng:</strong>
            <span id="scholarshipText"></span>
        </div>

        <div class="alert alert-warning" id="warningCard">
            <strong><i class="fas fa-exclamation-triangle"></i> Cảnh báo:</strong>
            <span id="warningText"></span>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div class="modal" id="aiChatModal">
        <div class="modal-content">
            <span class="close" onclick="closeAIChat()">&times;</span>
            <h3><i class="fas fa-robot"></i> AI Assistant - Tư vấn học tập</h3>
            <div class="chat-messages" id="chatMessages">
                <div style="text-align: center; color: #999; padding: 20px;">
                    <i class="fas fa-robot" style="font-size: 48px; margin-bottom: 15px;"></i>
                    <p>Xin chào! Tôi là AI Assistant. Tôi có thể giúp bạn:</p>
                    <ul style="text-align: left; display: inline-block;">
                        <li>Phân tích kết quả học tập</li>
                        <li>Tư vấn cách cải thiện GPA</li>
                        <li>Thông tin về học bổng</li>
                        <li>Dự đoán điểm cần thiết</li>
                    </ul>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="Nhập câu hỏi của bạn...">
                <button class="btn btn-primary" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Charts Modal -->
    <div class="charts-modal" id="chartsModal">
        <div class="charts-modal-content">
            <span class="close" onclick="closeChartsModal()" style="font-size: 28px;">&times;</span>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: #2c3e50; font-size: 2.5em; background: linear-gradient(45deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    <i class="fas fa-chart-line"></i> Biểu đồ thống kê điểm số
                </h2>
                <p>Trực quan hóa kết quả học tập qua 8 học kỳ</p>
            </div>

            <!-- Chart Stats -->
            <div class="chart-stats">
                <div class="stat-item">
                    <div style="font-size: 2em; font-weight: bold; margin-bottom: 5px;" id="totalSubjectsChart">0</div>
                    <div style="font-size: 14px; opacity: 0.9;">Tổng môn học</div>
                </div>
                <div class="stat-item">
                    <div style="font-size: 2em; font-weight: bold; margin-bottom: 5px;" id="avgGPAChart">0.00</div>
                                        <div style="font-size: 14px; opacity: 0.9;">GPA trung bình</div>
                </div>
                <div class="stat-item">
                    <div style="font-size: 2em; font-weight: bold; margin-bottom: 5px;" id="totalCreditsChart">0</div>
                    <div style="font-size: 14px; opacity: 0.9;">Tổng tín chỉ</div>
                </div>
                <div class="stat-item">
                    <div style="font-size: 2em; font-weight: bold; margin-bottom: 5px;" id="completedSemestersChart">0</div>
                    <div style="font-size: 14px; opacity: 0.9;">Học kỳ hoàn thành</div>
                </div>
            </div>

            <!-- Chart Tabs -->
            <div class="chart-tabs">
                <div class="chart-tab active" onclick="switchChartTab('overview')">
                    <i class="fas fa-chart-line"></i> Tổng quan
                </div>
                <div class="chart-tab" onclick="switchChartTab('distribution')">
                    <i class="fas fa-chart-pie"></i> Phân bố
                </div>
                <div class="chart-tab" onclick="switchChartTab('comparison')">
                    <i class="fas fa-chart-bar"></i> So sánh
                </div>
                <div class="chart-tab" onclick="switchChartTab('analysis')">
                    <i class="fas fa-chart-area"></i> Phân tích
                </div>
            </div>

            <!-- Chart Sections -->
            <div class="chart-section active" id="overviewSection">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div style="text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Xu hướng GPA qua các học kỳ
                        </div>
                        <canvas id="gpaChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div style="text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            GPA theo năm học
                        </div>
                        <canvas id="yearlyChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-section" id="distributionSection">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div style="text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Phân bố điểm các môn học
                        </div>
                        <canvas id="subjectChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div style="text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Phân bố xếp loại
                        </div>
                        <canvas id="gradeChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-section" id="comparisonSection">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div style="text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            So sánh điểm trung bình các thành phần
                        </div>
                        <canvas id="componentChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div style="text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Tín chỉ theo học kỳ
                        </div>
                        <canvas id="creditsChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-section" id="analysisSection">
                <div class="charts-grid">
                    <div class="chart-container">
                        <div style="text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Phân tích xu hướng cải thiện
                        </div>
                        <canvas id="trendChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div style="text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                            Dự đoán GPA tương lai
                        </div>
                        <canvas id="predictionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Global Variables
        let studentData = {
            semesters: {
                1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [], 8: []
            },
            currentSemester: 1
        };

        // Data Management
        function saveData() {
            localStorage.setItem('hubGPAData', JSON.stringify(studentData));
        }

        function loadData() {
            const saved = localStorage.getItem('hubGPAData');
            if (saved) {
                studentData = JSON.parse(saved);
            }
        }

        // Score Calculations
        function calculateSubjectScore(attendance, homework, midterm, final) {
            return attendance * 0.1 + homework * 0.2 + midterm * 0.2 + final * 0.5;
        }

        function convertTo4Scale(score10) {
            if (score10 >= 9.0) return 4.0;
            if (score10 >= 8.5) return 3.7;
            if (score10 >= 8.0) return 3.5;
            if (score10 >= 7.5) return 3.2;
            if (score10 >= 7.0) return 3.0;
            if (score10 >= 6.5) return 2.7;
            if (score10 >= 6.0) return 2.5;
            if (score10 >= 5.5) return 2.2;
            if (score10 >= 5.0) return 2.0;
            if (score10 >= 4.0) return 1.0;
            return 0.0;
        }

        function getGradeLevel(gpa) {
            if (gpa >= 3.6) return { text: 'Xuất sắc', class: 'grade-excellent' };
            if (gpa >= 3.2) return { text: 'Giỏi', class: 'grade-good' };
            if (gpa >= 2.5) return { text: 'Khá', class: 'grade-fair' };
            if (gpa >= 2.0) return { text: 'Trung bình', class: 'grade-average' };
            if (gpa >= 1.0) return { text: 'Yếu', class: 'grade-poor' };
            return { text: 'Kém', class: 'grade-poor' };
        }

        // Real-time score calculation
        function updateRealTimeScore() {
            const attendance = parseFloat(document.getElementById('attendance').value) || 0;
            const homework = parseFloat(document.getElementById('homework').value) || 0;
            const midterm = parseFloat(document.getElementById('midterm').value) || 0;
            const final = parseFloat(document.getElementById('final').value) || 0;

            const totalScore = calculateSubjectScore(attendance, homework, midterm, final);
            const gpa4 = convertTo4Scale(totalScore);
            const grade = getGradeLevel(gpa4);

            const display = document.getElementById('averageDisplay');
            display.textContent = `Điểm TB: ${totalScore.toFixed(2)} (GPA: ${gpa4.toFixed(2)} - ${grade.text})`;
            display.style.background = `linear-gradient(45deg, ${getGradeColor(gpa4)})`;
        }

        function getGradeColor(gpa) {
            if (gpa >= 3.6) return '#ff6b6b, #ff8e8e';
            if (gpa >= 3.2) return '#4834d4, #686de0';
            if (gpa >= 2.5) return '#f39c12, #f5b041';
            if (gpa >= 2.0) return '#2ed573, #7bed9f';
            return '#95a5a6, #b2bec3';
        }

        // Subject Management
        function addSubject() {
            const name = document.getElementById('subjectName').value.trim();
            const credits = parseInt(document.getElementById('credits').value);
            const attendance = parseFloat(document.getElementById('attendance').value);
            const homework = parseFloat(document.getElementById('homework').value);
            const midterm = parseFloat(document.getElementById('midterm').value);
            const final = parseFloat(document.getElementById('final').value);

            if (!name || !credits || isNaN(attendance) || isNaN(homework) || isNaN(midterm) || isNaN(final)) {
                alert('Vui lòng nhập đầy đủ thông tin!');
                return;
            }

            if (attendance < 0 || attendance > 10 || homework < 0 || homework > 10 || 
                midterm < 0 || midterm > 10 || final < 0 || final > 10) {
                alert('Điểm số phải trong khoảng 0-10!');
                return;
            }

            const totalScore = calculateSubjectScore(attendance, homework, midterm, final);
            const gpa4 = convertTo4Scale(totalScore);

            const subject = {
                id: Date.now(),
                name,
                credits,
                attendance,
                homework,
                midterm,
                final,
                totalScore: totalScore.toFixed(2),
                gpa4: gpa4.toFixed(2)
            };

            studentData.semesters[studentData.currentSemester].push(subject);
            saveData();
            
            // Clear form
            clearForm();
            updateDisplay();
            generateAISuggestions();
        }

        function clearForm() {
            document.getElementById('subjectName').value = '';
            document.getElementById('credits').value = '';
            document.getElementById('attendance').value = '';
            document.getElementById('homework').value = '';
            document.getElementById('midterm').value = '';
            document.getElementById('final').value = '';
            document.getElementById('averageDisplay').textContent = 'Điểm TB: --';
            document.getElementById('averageDisplay').style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
        }

        function deleteSubject(id) {
            if (confirm('Bạn có chắc chắn muốn xóa môn học này?')) {
                studentData.semesters[studentData.currentSemester] = 
                    studentData.semesters[studentData.currentSemester].filter(subject => subject.id !== id);
                saveData();
                updateDisplay();
                generateAISuggestions();
            }
        }

        // Display Functions
        function updateDisplay() {
            displaySubjects();
            calculateGPA();
            updateStatistics();
            updateYearlyGPA();
            checkScholarship();
            checkWarnings();
        }

        function displaySubjects() {
            const container = document.getElementById('subjectsList');
            const subjects = studentData.semesters[studentData.currentSemester];
            
            if (subjects.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Chưa có môn học nào. Hãy thêm môn học đầu tiên!</p>';
                return;
            }

            container.innerHTML = subjects.map(subject => `
                <div class="subject-item">
                    <div>
                        <strong>${subject.name}</strong>
                        <br><small>${subject.credits} tín chỉ</small>
                    </div>
                    <div class="subject-scores">
                        <div class="score-item">CC: ${subject.attendance}</div>
                        <div class="score-item">BT: ${subject.homework}</div>
                        <div class="score-item">GK: ${subject.midterm}</div>
                        <div class="score-item">CK: ${subject.final}</div>
                    </div>
                    <div>Điểm 10: <strong>${subject.totalScore}</strong></div>
                    <div>Điểm 4: <strong>${subject.gpa4}</strong></div>
                    <div>
                        <span class="grade-level ${getGradeLevel(parseFloat(subject.gpa4)).class}">
                            ${getGradeLevel(parseFloat(subject.gpa4)).text}
                        </span>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="deleteSubject(${subject.id})" style="padding: 8px 12px; font-size: 12px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function calculateGPA() {
            // Current semester GPA
            const currentSubjects = studentData.semesters[studentData.currentSemester];
            let currentGPA = 0;
            let currentCredits = 0;

            if (currentSubjects.length > 0) {
                let totalPoints = 0;
                currentSubjects.forEach(subject => {
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    currentCredits += subject.credits;
                });
                currentGPA = totalPoints / currentCredits;
            }

            // Cumulative GPA
            let cumulativeGPA = 0;
            let totalCredits = 0;
            let totalPoints = 0;

            Object.values(studentData.semesters).forEach(semester => {
                semester.forEach(subject => {
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    totalCredits += subject.credits;
                });
            });

            if (totalCredits > 0) {
                cumulativeGPA = totalPoints / totalCredits;
            }

            // Update display
            document.getElementById('currentGPA').textContent = currentGPA.toFixed(2);
            document.getElementById('cumulativeGPA').textContent = cumulativeGPA.toFixed(2);
            document.getElementById('totalCredits').textContent = totalCredits;

            // Update grades
            const currentGrade = getGradeLevel(currentGPA);
            const cumulativeGrade = getGradeLevel(cumulativeGPA);

            const currentGradeElement = document.getElementById('currentGrade');
            currentGradeElement.textContent = currentGrade.text;
            currentGradeElement.className = `grade-level ${currentGrade.class}`;

            const cumulativeGradeElement = document.getElementById('cumulativeGrade');
            cumulativeGradeElement.textContent = cumulativeGrade.text;
            cumulativeGradeElement.className = `grade-level ${cumulativeGrade.class}`;

            // Update progress bar
            const progressPercent = (currentGPA / 4.0) * 100;
            document.getElementById('gpaProgress').style.width = `${progressPercent}%`;
        }

        function updateYearlyGPA() {
            for (let year = 1; year <= 4; year++) {
                const semesters = year === 1 ? [1, 2] : year === 2 ? [3, 4] : year === 3 ? [5, 6] : [7, 8];
                let totalPoints = 0;
                let totalCredits = 0;

                semesters.forEach(sem => {
                    studentData.semesters[sem].forEach(subject => {
                        totalPoints += parseFloat(subject.gpa4) * subject.credits;
                        totalCredits += subject.credits;
                    });
                });

                const yearGPA = totalCredits > 0 ? (totalPoints / totalCredits).toFixed(2) : '--';
                document.getElementById(`year${year}GPA`).textContent = yearGPA;
            }
        }

        function updateStatistics() {
            let totalSubjects = 0;
            let totalScore = 0;
            let highestScore = 0;
            let lowestScore = 10;
            let highestSubject = '--';
            let lowestSubject = '--';

            Object.values(studentData.semesters).forEach(semester => {
                semester.forEach(subject => {
                    totalSubjects++;
                    const score = parseFloat(subject.totalScore);
                    totalScore += score;
                    
                    if (score > highestScore) {
                        highestScore = score;
                        highestSubject = subject.name;
                    }
                    
                    if (score < lowestScore) {
                        lowestScore = score;
                        lowestSubject = subject.name;
                    }
                });
            });

            document.getElementById('totalSubjects').textContent = totalSubjects;
            document.getElementById('averageScore').textContent = totalSubjects > 0 ? (totalScore / totalSubjects).toFixed(2) : '0.00';
            document.getElementById('highestSubject').textContent = `${highestSubject} (${highestScore.toFixed(2)})`;
            document.getElementById('lowestSubject').textContent = totalSubjects > 0 ? `${lowestSubject} (${lowestScore.toFixed(2)})` : '--';
        }

        // Notifications
        function checkScholarship() {
            const currentSubjects = studentData.semesters[studentData.currentSemester];
            const scholarshipCard = document.getElementById('scholarshipInfo');
            const scholarshipText = document.getElementById('scholarshipText');

            let currentCredits = 0;
            let currentGPA = 0;
            
            if (currentSubjects.length > 0) {
                let totalPoints = 0;
                currentSubjects.forEach(subject => {
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    currentCredits += subject.credits;
                });
                currentGPA = totalPoints / currentCredits;
            }

            if (currentCredits >= 15) {
                if (currentGPA >= 3.6) {
                    scholarshipCard.style.display = 'block';
                    scholarshipText.textContent = 'Chúc mừng! Bạn đủ điều kiện xét học bổng khuyến khích học tập với GPA xuất sắc!';
                } else if (currentGPA >= 3.2) {
                    scholarshipCard.style.display = 'block';
                    scholarshipText.textContent = 'Bạn đủ điều kiện xét học bổng với GPA giỏi. Hãy cố gắng duy trì!';
                } else if (currentGPA >= 2.5) {
                    scholarshipCard.style.display = 'block';
                    scholarshipText.textContent = 'Bạn có thể xét học bổng nếu cải thiện thêm một chút điểm số.';
                } else {
                    scholarshipCard.style.display = 'none';
                }
            } else {
                scholarshipCard.style.display = 'none';
            }
        }

        function checkWarnings() {
            const currentSubjects = studentData.semesters[studentData.currentSemester];
            const warningCard = document.getElementById('warningCard');
            const warningText = document.getElementById('warningText');

            let currentCredits = 0;
            let currentGPA = 0;
            
            if (currentSubjects.length > 0) {
                let totalPoints = 0;
                currentSubjects.forEach(subject => {
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    currentCredits += subject.credits;
                });
                currentGPA = totalPoints / currentCredits;
            }

            if (currentCredits < 15 && currentCredits > 0) {
                warningCard.style.display = 'block';
                warningText.textContent = 'Cảnh báo: Số tín chỉ dưới 15, bạn không đủ điều kiện xét học bổng và danh hiệu.';
            } else if (currentGPA < 2.0 && currentGPA > 0) {
                warningCard.style.display = 'block';
                warningText.textContent = 'Cảnh báo học vụ: GPA dưới 2.0, bạn cần cải thiện kết quả học tập.';
            } else {
                warningCard.style.display = 'none';
            }
        }

        // AI Assistant
        function generateAISuggestions() {
            const suggestionsContainer = document.getElementById('suggestionsContent');
            const currentSubjects = studentData.semesters[studentData.currentSemester];
            
            let suggestions = [];

            if (currentSubjects.length === 0) {
                suggestions.push({
                    icon: 'fas fa-info-circle',
                    title: 'Bắt đầu nhập điểm',
                    content: 'Hãy thêm các môn học và điểm số để AI có thể phân tích và đưa ra gợi ý phù hợp qua 8 học kỳ.'
                });
            } else {
                let currentGPA = 0;
                let totalPoints = 0;
                let totalCredits = 0;
                let lowestScore = 10;
                let highestScore = 0;

                currentSubjects.forEach(subject => {
                    const score = parseFloat(subject.totalScore);
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    totalCredits += subject.credits;
                    
                    if (score < lowestScore) lowestScore = score;
                    if (score > highestScore) highestScore = score;
                });

                currentGPA = totalPoints / totalCredits;

                // GPA-based suggestions
                if (currentGPA >= 3.6) {
                    suggestions.push({
                        icon: 'fas fa-star',
                        title: 'Xuất sắc!',
                        content: 'Kết quả học tập của bạn rất tuyệt vời! Hãy duy trì phong độ này và tham gia thêm các hoạt động ngoại khóa.'
                    });
                } else if (currentGPA >= 3.2) {
                    suggestions.push({
                        icon: 'fas fa-thumbs-up',
                        title: 'Kết quả tốt',
                        content: 'Bạn đang học tập rất tốt. Hãy cố gắng thêm một chút để đạt mức xuất sắc!'
                    });
                } else if (currentGPA >= 2.5) {
                    suggestions.push({
                        icon: 'fas fa-chart-line',
                        title: 'Cần cải thiện',
                        content: 'Hãy tập trung vào các môn có điểm thấp và cải thiện phương pháp học tập.'
                    });
                } else {
                    suggestions.push({
                        icon: 'fas fa-exclamation-triangle',
                        title: 'Cần nỗ lực hơn',
                        content: 'Kết quả học tập cần được cải thiện đáng kể. Hãy tìm kiếm sự hỗ trợ từ giảng viên và bạn bè.'
                    });
                }

                if (lowestScore < 5.0) {
                    suggestions.push({
                        icon: 'fas fa-book',
                        title: 'Tập trung vào môn yếu',
                        content: 'Bạn có môn học với điểm số thấp. Hãy dành thêm thời gian ôn tập và tìm hiểu sâu hơn.'
                    });
                }

                if (totalCredits < 15) {
                    suggestions.push({
                        icon: 'fas fa-calendar-plus',
                        title: 'Đăng ký thêm môn',
                        content: 'Số tín chỉ hiện tại chưa đủ 15. Hãy đăng ký thêm môn học để đủ điều kiện xét học bổng.'
                    });
                }

                suggestions.push({
                    icon: 'fas fa-lightbulb',
                    title: 'Mẹo học tập',
                    content: 'Hãy duy trì thói quen học đều đặn, tham gia đầy đủ các buổi học và hoàn thành bài tập đúng hạn.'
                });
            }

            suggestionsContainer.innerHTML = suggestions.map(suggestion => `
                <div class="suggestion-item">
                    <i class="${suggestion.icon}" style="margin-right: 10px;"></i>
                    <strong>${suggestion.title}:</strong> ${suggestion.content}
                </div>
            `).join('');
        }

        // Semester Management
        function switchSemester(semester) {
            studentData.currentSemester = semester;
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-semester="${semester}"]`).classList.add('active');
            
            // Update title
            document.getElementById('currentSemesterTitle').textContent = `Học kỳ ${semester}`;
            
            updateDisplay();
            generateAISuggestions();
        }

        // AI Chat
        function showAIChat() {
            document.getElementById('aiChatModal').style.display = 'block';
        }

        function closeAIChat() {
            document.getElementById('aiChatModal').style.display = 'none';
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            const chatMessages = document.getElementById('chatMessages');
            
            // User message
            chatMessages.innerHTML += `
                <div style="text-align: right; margin: 10px 0;">
                    <div style="background: #667eea; color: white; padding: 10px; border-radius: 8px; display: inline-block; max-width: 80%;">
                        <strong>Bạn:</strong> ${message}
                    </div>
                </div>
            `;

            // AI response
            const aiResponse = generateAIResponse(message);
            
            setTimeout(() => {
                chatMessages.innerHTML += `
                    <div style="margin: 10px 0;">
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; display: inline-block; max-width: 80%;">
                            <strong>AI:</strong> ${aiResponse}
                        </div>
                    </div>
                `;
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);

            input.value = '';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Calculate current stats
            let totalSubjects = 0;
            let totalGPA = 0;
            let totalCredits = 0;
            
            Object.values(studentData.semesters).forEach(semester => {
                semester.forEach(subject => {
                    totalSubjects++;
                    totalGPA += parseFloat(subject.gpa4) * subject.credits;
                    totalCredits += subject.credits;
                });
            });
            
            const currentGPA = totalCredits > 0 ? (totalGPA / totalCredits).toFixed(2) : 0;

            if (lowerMessage.includes('gpa') || lowerMessage.includes('điểm')) {
                return `GPA tích lũy hiện tại của bạn là ${currentGPA}/4.0 với tổng ${totalCredits} tín chỉ qua ${Object.keys(studentData.semesters).filter(sem => studentData.semesters[sem].length > 0).length} học kỳ. ${currentGPA >= 3.2 ? 'Kết quả rất tốt!' : 'Hãy cố gắng cải thiện thêm nhé!'}`;
            }
            
            if (lowerMessage.includes('học bổng') || lowerMessage.includes('scholarship')) {
                if (currentGPA >= 3.6) {
                    return 'Tuyệt vời! Với GPA hiện tại, bạn đủ điều kiện xét học bổng khuyến khích học tập. Hãy duy trì kết quả này!';
                } else if (currentGPA >= 3.2) {
                    return 'Bạn đang có cơ hội tốt để xét học bổng. Hãy cố gắng nâng cao thêm một chút điểm số!';
                } else {
                    return `Để đủ điều kiện xét học bổng, bạn cần GPA tối thiểu 3.2. Hiện tại bạn đang ở mức ${currentGPA}, hãy cố gắng cải thiện!`;
                }
            }
            
            if (lowerMessage.includes('cải thiện') || lowerMessage.includes('học tập')) {
                                return 'Một số gợi ý để cải thiện kết quả học tập: 1) Tham gia đầy đủ các buổi học, 2) Hoàn thành bài tập đúng hạn, 3) Ôn tập thường xuyên, 4) Tham gia nhóm học tập, 5) Tìm kiếm sự hỗ trợ từ giảng viên khi cần thiết.';
            }
            
            if (lowerMessage.includes('dự đoán') || lowerMessage.includes('predict')) {
                const targetGPA = 3.6;
                const remainingCredits = 120 - totalCredits; // Giả sử tổng 120 tín chỉ
                const requiredPoints = targetGPA * (totalCredits + remainingCredits) - totalGPA;
                const requiredGPA = remainingCredits > 0 ? (requiredPoints / remainingCredits).toFixed(2) : 0;
                
                if (requiredGPA <= 4.0 && remainingCredits > 0) {
                    return `Để đạt GPA ${targetGPA}, bạn cần đạt GPA trung bình ${requiredGPA} trong ${remainingCredits} tín chỉ còn lại. ${requiredGPA <= 3.0 ? 'Hoàn toàn có thể đạt được!' : 'Cần nỗ lực nhiều hơn!'}`;
                } else {
                    return 'Với kết quả hiện tại, bạn đang trên đường đạt mục tiêu. Hãy duy trì phong độ!';
                }
            }
            
            if (lowerMessage.includes('xếp loại') || lowerMessage.includes('tốt nghiệp')) {
                const grade = getGradeLevel(parseFloat(currentGPA));
                return `Với GPA ${currentGPA}, bạn đang ở mức xếp loại "${grade.text}". ${grade.text === 'Xuất sắc' ? 'Tuyệt vời!' : `Để đạt xếp loại cao hơn, hãy cố gắng nâng cao GPA lên mức ${grade.text === 'Giỏi' ? '3.6' : grade.text === 'Khá' ? '3.2' : '2.5'}.`}`;
            }
            
            if (lowerMessage.includes('thống kê') || lowerMessage.includes('tổng quan')) {
                return `Thống kê tổng quan: Tổng ${totalSubjects} môn học, ${totalCredits} tín chỉ, GPA ${currentGPA}/4.0. Bạn đã hoàn thành ${Object.keys(studentData.semesters).filter(sem => studentData.semesters[sem].length > 0).length}/8 học kỳ.`;
            }
            
            return 'Tôi có thể giúp bạn về: GPA và điểm số, thông tin học bổng, gợi ý cải thiện học tập, dự đoán kết quả, xếp loại tốt nghiệp. Hãy hỏi tôi cụ thể hơn nhé!';
        }

        // Charts Functions
        function showChartsModal() {
            document.getElementById('chartsModal').style.display = 'block';
            updateChartStats();
            setTimeout(() => {
                initializeTabCharts('overview');
            }, 100);
        }

        function closeChartsModal() {
            document.getElementById('chartsModal').style.display = 'none';
        }

        function switchChartTab(tabName) {
            // Remove active from all sections and tabs
            document.querySelectorAll('.chart-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Add active to selected
            document.getElementById(tabName + 'Section').classList.add('active');
            event.target.classList.add('active');
            
            // Initialize charts for selected tab
            setTimeout(() => {
                initializeTabCharts(tabName);
            }, 100);
        }

        function initializeTabCharts(tabName) {
            switch(tabName) {
                case 'overview':
                    createGPAChart();
                    createYearlyComparisonChart();
                    break;
                case 'distribution':
                    createSubjectDistributionChart();
                    createGradeDistributionChart();
                    break;
                case 'comparison':
                    createComponentComparisonChart();
                    createCreditsChart();
                    break;
                case 'analysis':
                    createTrendAnalysisChart();
                    createPredictionChart();
                    break;
            }
        }

        function updateChartStats() {
            let totalSubjects = 0;
            let totalGPA = 0;
            let totalCredits = 0;
            let completedSemesters = 0;
            
            Object.values(studentData.semesters).forEach(semester => {
                if (semester.length > 0) {
                    completedSemesters++;
                    semester.forEach(subject => {
                        totalSubjects++;
                        totalGPA += parseFloat(subject.gpa4) * subject.credits;
                        totalCredits += subject.credits;
                    });
                }
            });
            
            const avgGPA = totalCredits > 0 ? (totalGPA / totalCredits).toFixed(2) : '0.00';
            
            document.getElementById('totalSubjectsChart').textContent = totalSubjects;
            document.getElementById('avgGPAChart').textContent = avgGPA;
            document.getElementById('totalCreditsChart').textContent = totalCredits;
            document.getElementById('completedSemestersChart').textContent = completedSemesters;
        }

        // Chart Creation Functions
        function createGPAChart() {
            const ctx = document.getElementById('gpaChart').getContext('2d');
            
            const gpaData = [];
            const labels = [];
            
            for (let i = 1; i <= 8; i++) {
                const subjects = studentData.semesters[i];
                if (subjects.length > 0) {
                    let totalPoints = 0;
                    let totalCredits = 0;
                    
                    subjects.forEach(subject => {
                        totalPoints += parseFloat(subject.gpa4) * subject.credits;
                        totalCredits += subject.credits;
                    });
                    
                    const gpa = totalPoints / totalCredits;
                    gpaData.push(gpa.toFixed(2));
                    labels.push(`HK ${i}`);
                }
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'GPA theo học kỳ',
                        data: gpaData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: { stepSize: 0.5 }
                        }
                    }
                }
            });
        }

        function createYearlyComparisonChart() {
            const ctx = document.getElementById('yearlyChart').getContext('2d');
            
            const yearlyData = [];
            const yearLabels = ['Năm 1', 'Năm 2', 'Năm 3', 'Năm 4'];
            
            for (let year = 1; year <= 4; year++) {
                const semesters = year === 1 ? [1, 2] : year === 2 ? [3, 4] : year === 3 ? [5, 6] : [7, 8];
                let totalPoints = 0;
                let totalCredits = 0;

                semesters.forEach(sem => {
                    studentData.semesters[sem].forEach(subject => {
                        totalPoints += parseFloat(subject.gpa4) * subject.credits;
                        totalCredits += subject.credits;
                    });
                });

                const yearGPA = totalCredits > 0 ? totalPoints / totalCredits : 0;
                yearlyData.push(yearGPA.toFixed(2));
            }

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: yearLabels,
                    datasets: [{
                        label: 'GPA theo năm học',
                        data: yearlyData,
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(255, 107, 107, 0.8)',
                            'rgba(46, 213, 115, 0.8)'
                        ],
                        borderColor: [
                            '#667eea', '#764ba2', '#ff6b6b', '#2ed573'
                        ],
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: { stepSize: 0.5 }
                        }
                    }
                }
            });
        }

        function createSubjectDistributionChart() {
            const ctx = document.getElementById('subjectChart').getContext('2d');
            
            const scoreRanges = {
                'Xuất sắc (9-10)': 0,
                'Giỏi (8-8.9)': 0,
                'Khá (7-7.9)': 0,
                'Trung bình (5.5-6.9)': 0,
                'Yếu (4-5.4)': 0,
                'Kém (<4)': 0
            };

            Object.values(studentData.semesters).forEach(semester => {
                semester.forEach(subject => {
                    const score = parseFloat(subject.totalScore);
                    if (score >= 9) scoreRanges['Xuất sắc (9-10)']++;
                    else if (score >= 8) scoreRanges['Giỏi (8-8.9)']++;
                    else if (score >= 7) scoreRanges['Khá (7-7.9)']++;
                    else if (score >= 5.5) scoreRanges['Trung bình (5.5-6.9)']++;
                    else if (score >= 4) scoreRanges['Yếu (4-5.4)']++;
                    else scoreRanges['Kém (<4)']++;
                });
            });

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(scoreRanges),
                    datasets: [{
                        data: Object.values(scoreRanges),
                        backgroundColor: [
                            '#ff6b6b', '#4834d4', '#f39c12', '#2ed573', '#ff9ff3', '#95a5a6'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 20, usePointStyle: true }
                        }
                    }
                }
            });
        }

        function createGradeDistributionChart() {
            const ctx = document.getElementById('gradeChart').getContext('2d');
            
            const gradeCount = {
                'Xuất sắc': 0, 'Giỏi': 0, 'Khá': 0, 'Trung bình': 0, 'Yếu': 0, 'Kém': 0
            };

            Object.values(studentData.semesters).forEach(semester => {
                semester.forEach(subject => {
                    const gpa = parseFloat(subject.gpa4);
                    const grade = getGradeLevel(gpa);
                    gradeCount[grade.text]++;
                });
            });

            new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: Object.keys(gradeCount),
                    datasets: [{
                        data: Object.values(gradeCount),
                        backgroundColor: [
                            'rgba(255, 107, 107, 0.7)',
                            'rgba(72, 52, 212, 0.7)',
                            'rgba(243, 156, 18, 0.7)',
                            'rgba(46, 213, 115, 0.7)',
                            'rgba(255, 159, 243, 0.7)',
                            'rgba(149, 165, 166, 0.7)'
                        ],
                        borderColor: [
                            '#ff6b6b', '#4834d4', '#f39c12', '#2ed573', '#ff9ff3', '#95a5a6'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 15, usePointStyle: true }
                        }
                    }
                }
            });
        }

        function createComponentComparisonChart() {
            const ctx = document.getElementById('componentChart').getContext('2d');
            
            let totalAttendance = 0, totalHomework = 0, totalMidterm = 0, totalFinal = 0;
            let count = 0;
            
            Object.values(studentData.semesters).forEach(semester => {
                semester.forEach(subject => {
                    totalAttendance += parseFloat(subject.attendance);
                    totalHomework += parseFloat(subject.homework);
                    totalMidterm += parseFloat(subject.midterm);
                    totalFinal += parseFloat(subject.final);
                    count++;
                });
            });
            
            if (count === 0) return;
            
            const avgScores = [
                (totalAttendance / count).toFixed(2),
                (totalHomework / count).toFixed(2),
                (totalMidterm / count).toFixed(2),
                (totalFinal / count).toFixed(2)
            ];

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Chuyên cần', 'Bài tập', 'Giữa kỳ', 'Cuối kỳ'],
                    datasets: [{
                        label: 'Điểm trung bình',
                        data: avgScores,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: '#667eea',
                        borderWidth: 2,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: { stepSize: 2 }
                        }
                    }
                }
            });
        }

        function createCreditsChart() {
            const ctx = document.getElementById('creditsChart').getContext('2d');
            
            const creditsData = [];
            const labels = [];
            
            for (let i = 1; i <= 8; i++) {
                const subjects = studentData.semesters[i];
                let totalCredits = 0;
                
                subjects.forEach(subject => {
                    totalCredits += subject.credits;
                });
                
                creditsData.push(totalCredits);
                labels.push(`HK ${i}`);
            }

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Số tín chỉ',
                        data: creditsData,
                        backgroundColor: 'rgba(46, 213, 115, 0.8)',
                        borderColor: '#2ed573',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 5 }
                        }
                    }
                }
            });
        }

        function createTrendAnalysisChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            const semesterGPAs = [];
            const trendLine = [];
            const labels = [];
            
            for (let i = 1; i <= 8; i++) {
                const subjects = studentData.semesters[i];
                if (subjects.length > 0) {
                    let totalPoints = 0;
                    let totalCredits = 0;
                    
                    subjects.forEach(subject => {
                        totalPoints += parseFloat(subject.gpa4) * subject.credits;
                        totalCredits += subject.credits;
                    });
                    
                    const gpa = totalPoints / totalCredits;
                    semesterGPAs.push(gpa);
                    labels.push(`HK ${i}`);
                }
            }
            
            // Simple trend line calculation
            if (semesterGPAs.length > 1) {
                const n = semesterGPAs.length;
                let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
                
                for (let i = 0; i < n; i++) {
                    sumX += i;
                    sumY += semesterGPAs[i];
                    sumXY += i * semesterGPAs[i];
                    sumXX += i * i;
                }
                
                const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;
                
                for (let i = 0; i < n; i++) {
                    trendLine.push(slope * i + intercept);
                }
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'GPA thực tế',
                        data: semesterGPAs,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }, {
                        label: 'Xu hướng',
                        data: trendLine,
                        borderColor: '#ff6b6b',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: { stepSize: 0.5 }
                        }
                    }
                }
            });
        }

        function createPredictionChart() {
            const ctx = document.getElementById('predictionChart').getContext('2d');
            
            const actualGPAs = [];
            const predictedGPAs = [];
            const labels = [];
            
            // Get actual GPAs
            for (let i = 1; i <= 8; i++) {
                const subjects = studentData.semesters[i];
                let gpa = null;
                
                if (subjects.length > 0) {
                    let totalPoints = 0;
                    let totalCredits = 0;
                    
                    subjects.forEach(subject => {
                        totalPoints += parseFloat(subject.gpa4) * subject.credits;
                        totalCredits += subject.credits;
                    });
                    
                    gpa = totalPoints / totalCredits;
                }
                
                actualGPAs.push(gpa);
                labels.push(`HK ${i}`);
            }
            
            // Simple prediction based on trend
            const validGPAs = actualGPAs.filter(gpa => gpa !== null);
            if (validGPAs.length >= 2) {
                const lastGPA = validGPAs[validGPAs.length - 1];
                const secondLastGPA = validGPAs[validGPAs.length - 2];
                const trend = lastGPA - secondLastGPA;
                
                for (let i = 0; i < 8; i++) {
                    if (actualGPAs[i] !== null) {
                        predictedGPAs.push(actualGPAs[i]);
                    } else {
                        const lastValidIndex = actualGPAs.slice(0, i).lastIndexOf(actualGPAs.slice(0, i).find(gpa => gpa !== null));
                        if (lastValidIndex >= 0) {
                            const prediction = Math.max(0, Math.min(4, actualGPAs[lastValidIndex] + trend * (i - lastValidIndex)));
                            predictedGPAs.push(prediction);
                        } else {
                            predictedGPAs.push(null);
                        }
                    }
                }
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'GPA thực tế',
                        data: actualGPAs,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }, {
                        label: 'GPA dự đoán',
                        data: predictedGPAs,
                        borderColor: '#2ed573',
                        backgroundColor: 'rgba(46, 213, 115, 0.1)',
                        borderWidth: 2,
                        borderDash: [10, 5],
                        fill: false,
                        tension: 0.4,
                        pointBackgroundColor: '#2ed573',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: { stepSize: 0.5 }
                        }
                    }
                }
            });
        }

        // Utility Functions
        function predictRequiredScore() {
            const targetGPA = prompt('Nhập GPA mục tiêu (0-4):');
            if (!targetGPA || isNaN(targetGPA) || targetGPA < 0 || targetGPA > 4) {
                alert('Vui lòng nhập GPA hợp lệ (0-4)!');
                return;
            }

            let totalPoints = 0;
            let totalCredits = 0;
            
            Object.values(studentData.semesters).forEach(semester => {
                semester.forEach(subject => {
                    totalPoints += parseFloat(subject.gpa4) * subject.credits;
                    totalCredits += subject.credits;
                });
            });

            const remainingCredits = 120 - totalCredits; // Giả sử tổng 120 tín chỉ
            const requiredPoints = parseFloat(targetGPA) * (totalCredits + remainingCredits) - totalPoints;
            const requiredGPA = remainingCredits > 0 ? (requiredPoints / remainingCredits).toFixed(2) : 0;

            if (remainingCredits <= 0) {
                alert('Bạn đã hoàn thành tất cả tín chỉ!');
            } else if (requiredGPA > 4.0) {
                alert(`Không thể đạt GPA ${targetGPA} với kết quả hiện tại.`);
            } else if (requiredGPA < 0) {
                alert(`Bạn đã vượt mục tiêu! GPA hiện tại cao hơn ${targetGPA}.`);
            } else {
                alert(`Để đạt GPA ${targetGPA}, bạn cần GPA trung bình ${requiredGPA} trong ${remainingCredits} tín chỉ còn lại.`);
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(studentData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'hub_gpa_data_8semesters.json';
            link.click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        studentData.semesters = {
                            1: importedData.semesters[1] || [],
                            2: importedData.semesters[2] || [],
                            3: importedData.semesters[3] || [],
                            4: importedData.semesters[4] || [],
                            5: importedData.semesters[5] || [],
                            6: importedData.semesters[6] || [],
                            7: importedData.semesters[7] || [],
                            8: importedData.semesters[8] || []
                        };
                        studentData.currentSemester = importedData.currentSemester || 1;
                        saveData();
                        updateDisplay();
                        generateAISuggestions();
                        alert('Dữ liệu đã được import thành công!');
                    } catch (error) {
                        alert('Lỗi khi import dữ liệu. Vui lòng kiểm tra file!');
                    }
                };
                reader.readAsText(file);
            }
        }

        function resetAllData() {
            if (confirm('Bạn có chắc chắn muốn xóa tất cả dữ liệu? Hành động này không thể hoàn tác!')) {
                studentData = {
                    semesters: {
                        1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [], 8: []
                    },
                    currentSemester: 1
                };
                localStorage.removeItem('hubGPAData');
                switchSemester(1);
                updateDisplay();
                generateAISuggestions();
                alert('Đã xóa tất cả dữ liệu thành công!');
            }
        }

        function showHelpModal() {
            const helpModal = document.createElement('div');
            helpModal.className = 'modal';
            helpModal.style.display = 'block';
            helpModal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <h3><i class="fas fa-book"></i> Hướng dẫn sử dụng HUB GPA Calculator</h3>
                    
                    <div style="margin: 20px 0;">
                        <h4><i class="fas fa-graduation-cap"></i> Giới thiệu</h4>
                        <p>Ứng dụng tính điểm GPA thông minh dành cho sinh viên Đại học Ngân Hàng, hỗ trợ quản lý điểm số qua 8 học kỳ với AI Assistant.</p>
                        
                        <h4><i class="fas fa-calculator"></i> Cách tính điểm</h4>
                        <ul>
                            <li><strong>Điểm tổng kết:</strong> Chuyên cần (10%) + Bài tập (20%) + Giữa kỳ (20%) + Cuối kỳ (50%)</li>
                            <li><strong>GPA:</strong> Chuyển đổi từ thang điểm 10 sang thang điểm 4</li>
                                                        <li><strong>GPA tích lũy:</strong> Tính theo tín chỉ có trọng số</li>
                        </ul>
                        
                        <h4><i class="fas fa-chart-bar"></i> Tính năng chính</h4>
                        <ul>
                            <li>Quản lý điểm qua 8 học kỳ (4 năm đại học)</li>
                            <li>Tính toán GPA tự động và chính xác</li>
                            <li>Trực quan hóa dữ liệu bằng biểu đồ đa dạng</li>
                            <li>AI Assistant hỗ trợ tư vấn học tập</li>
                            <li>Dự đoán điểm cần thiết để đạt mục tiêu</li>
                            <li>Xuất/nhập dữ liệu để sao lưu</li>
                        </ul>
                        
                        <h4><i class="fas fa-star"></i> Xếp loại tốt nghiệp</h4>
                        <ul>
                            <li><strong>Xuất sắc:</strong> GPA ≥ 3.6</li>
                            <li><strong>Giỏi:</strong> 3.2 ≤ GPA < 3.6</li>
                            <li><strong>Khá:</strong> 2.5 ≤ GPA < 3.2</li>
                            <li><strong>Trung bình:</strong> 2.0 ≤ GPA < 2.5</li>
                        </ul>
                        
                        <h4><i class="fas fa-award"></i> Học bổng</h4>
                        <p>Để đủ điều kiện xét học bổng, bạn cần:</p>
                        <ul>
                            <li>Đăng ký tối thiểu 15 tín chỉ/học kỳ</li>
                            <li>GPA học kỳ ≥ 3.2 (Khuyến khích học tập)</li>
                            <li>GPA học kỳ ≥ 3.6 (Học bổng cao)</li>
                        </ul>

                        <h4><i class="fas fa-keyboard"></i> Phím tắt</h4>
                        <ul>
                            <li><kbd>Ctrl + S</kbd>: Xuất dữ liệu</li>
                            <li><kbd>Ctrl + N</kbd>: Focus vào ô tên môn học</li>
                            <li><kbd>Ctrl + D</kbd>: Xem biểu đồ</li>
                            <li><kbd>Ctrl + H</kbd>: Hiển thị hướng dẫn</li>
                            <li><kbd>1-8</kbd>: Chuyển học kỳ</li>
                        </ul>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="this.parentElement.parentElement.parentElement.remove()">
                            Đã hiểu
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(helpModal);
        }

        function showWelcomeMessage() {
            const welcome = document.createElement('div');
            welcome.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                z-index: 1000;
                max-width: 300px;
                animation: slideIn 0.5s ease-out;
            `;
            
            welcome.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <i class="fas fa-graduation-cap" style="font-size: 24px; margin-right: 10px;"></i>
                    <strong>Chào mừng đến với HUB GPA Calculator!</strong>
                </div>
                <p style="margin: 0; font-size: 14px; opacity: 0.9;">
                    Hệ thống tính điểm thông minh hỗ trợ 8 học kỳ với AI Assistant. 
                    Nhấn <kbd>Ctrl+H</kbd> để xem hướng dẫn chi tiết.
                </p>
                <button onclick="this.parentElement.remove()" style="
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    background: none;
                    border: none;
                    color: white;
                    font-size: 18px;
                    cursor: pointer;
                ">&times;</button>
            `;
            
            document.body.appendChild(welcome);
            
            setTimeout(() => {
                if (welcome.parentElement) {
                    welcome.remove();
                }
            }, 10000);
        }

        function autoBackup() {
            const lastBackup = localStorage.getItem('lastBackup');
            const now = new Date().getTime();
            
            if (!lastBackup || (now - parseInt(lastBackup)) > 24 * 60 * 60 * 1000) {
                const backupData = JSON.stringify(studentData);
                localStorage.setItem('hubGPABackup', backupData);
                localStorage.setItem('lastBackup', now.toString());
            }
        }

        function restoreFromBackup() {
            const backup = localStorage.getItem('hubGPABackup');
            if (backup && confirm('Bạn có muốn khôi phục dữ liệu từ bản sao lưu không?')) {
                try {
                    const backupData = JSON.parse(backup);
                    studentData = backupData;
                    saveData();
                    updateDisplay();
                    generateAISuggestions();
                    alert('Đã khôi phục dữ liệu thành công!');
                } catch (error) {
                    alert('Lỗi khi khôi phục dữ liệu!');
                }
            }
        }

        // Event Listeners and Initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Load data
            loadData();
            
            // Setup tab listeners
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    if (this.dataset.semester) {
                        switchSemester(parseInt(this.dataset.semester));
                    }
                });
            });

            // Setup real-time score calculation
            ['attendance', 'homework', 'midterm', 'final'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateRealTimeScore);
            });

            // Chat input handler
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    exportData();
                }
                
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    document.getElementById('subjectName').focus();
                }
                
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    showChartsModal();
                }
                
                if (e.ctrlKey && e.key === 'h') {
                    e.preventDefault();
                    showHelpModal();
                }
                
                if (e.key >= '1' && e.key <= '8' && !e.ctrlKey && !e.altKey) {
                    const activeElement = document.activeElement;
                    if (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA') {
                        switchSemester(parseInt(e.key));
                    }
                }
            });

            // Modal close handlers
            window.addEventListener('click', function(event) {
                const aiModal = document.getElementById('aiChatModal');
                const chartsModal = document.getElementById('chartsModal');
                
                if (event.target === aiModal) {
                    closeAIChat();
                }
                if (event.target === chartsModal) {
                    closeChartsModal();
                }
            });
            
            // Initial display update
            updateDisplay();
            generateAISuggestions();
            
            // Auto backup
            autoBackup();
            
            // Check for backup on startup
            const backup = localStorage.getItem('hubGPABackup');
            const mainData = localStorage.getItem('hubGPAData');
            if (backup && !mainData) {
                restoreFromBackup();
            }
            
            // Show welcome message for first-time users
            setTimeout(() => {
                if (!localStorage.getItem('welcomeShown')) {
                    showWelcomeMessage();
                    localStorage.setItem('welcomeShown', 'true');
                }
            }, 1000);
        });
    </script>
</body>
</html>


